<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tool T·∫°o B√†i Vi·∫øt SEO T·ª± ƒê·ªông (N√©n WebP)</title>
  <style>
    /* ======== General Reset ======== */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    /* ======== Container & Header ======== */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(45deg, #ff6b6b, #ee5a24);
      color: #fff;
      padding: 30px;
      text-align: center;
    }
    .header h1 { font-size: 2.5rem; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); }
    .header p { font-size: 1.1rem; opacity: 0.9; }

    /* ======== Main Grid ======== */
    .main-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      padding: 30px;
    }

    /* ======== Upload Section ======== */
    .upload-section { background: #f8f9fa; border-radius: 15px; padding: 30px; }
    .dropzone {
      border: 3px dashed #007bff;
      border-radius: 15px;
      padding: 40px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
      background: #fff;
      position: relative;
    }
    .dropzone:hover { border-color: #0056b3; background: #f0f8ff; transform: translateY(-2px); }
    .dropzone.dropzone-dragging { border-color: #28a745; background: #f0fff0; transform: scale(1.02); }
    .dropzone p { margin: 10px 0; font-size: 1.1rem; color: #666; }
    .upload-icon { font-size: 3rem; color: #007bff; margin-bottom: 15px; }
    .input { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }

    /* Slider */
    .slider-box { margin-top: 25px; text-align: center; }
    .slider-box label { font-weight: 600; margin-right: 10px; }
    #qualityValue { font-weight: bold; }

    /* ======== Settings Section ======== */
    .settings-section { background: #f8f9fa; border-radius: 15px; padding: 30px; }
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
    .form-control {
      width: 100%;
      padding: 12px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    .form-control:focus { outline: none; border-color: #007bff; box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1); }

    /* ======== Buttons ======== */
    .btn {
      background: linear-gradient(45deg, #007bff, #0056b3);
      color: #fff;
      padding: 12px 25px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s ease;
      margin: 5px;
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 123, 255, 0.3); }
    .btn-success { background: linear-gradient(45deg, #28a745, #20c997); }
    .btn-warning { background: linear-gradient(45deg, #ffc107, #fd7e14); }

    /* ======== Uploaded images ======== */
    .uploaded-images { margin-top: 20px; }
    .image-item { background: #fff; border-radius: 10px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); }
    .image-preview { max-width: 100%; max-height: 200px; border-radius: 8px; margin-bottom: 10px; }
    .image-url { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; font-size: 0.9rem; background: #f8f9fa; }

    /* ======== Status ======== */
    .status { margin-top: 15px; padding: 10px; border-radius: 5px; text-align: center; }
    .bg-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .bg-danger { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .bg-info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }

    /* ======== Responsive ======== */
    @media (max-width: 768px) {
      .main-content { grid-template-columns: 1fr; gap: 20px; padding: 20px; }
      .header h1 { font-size: 2rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üöÄ Tool T·∫°o B√†i Vi·∫øt SEO T·ª± ƒê·ªông</h1>
      <p>Upload ·∫£nh ‚Äì N√©n WebP ‚Äì Vi·∫øt b√†i Blogger</p>
    </div>

    <div class="main-content">
      <!-- ========= Upload Section ========= -->
      <div class="upload-section">
        <h3>üì∏ Upload ·∫¢nh</h3>
        <div class="dropzone">
          <div class="upload-icon">‚òÅÔ∏è</div>
          <p><strong>K√©o th·∫£ ·∫£nh v√†o ƒë√¢y</strong></p>
          <p>ho·∫∑c click ƒë·ªÉ ch·ªçn file</p>
          <input type="file" class="input" accept="image/*" multiple />
        </div>

        <!-- Slider quality -->
        <div class="slider-box">
          <label for="qualityRange">Ch·∫•t l∆∞·ª£ng WebP:</label>
          <input type="range" id="qualityRange" min="0.1" max="1" step="0.1" value="0.6" oninput="document.getElementById('qualityValue').textContent = this.value" />
          <span id="qualityValue">0.6</span>
        </div>

        <div class="status"></div>
        <div class="uploaded-images"></div>
      </div>

      <!-- ========= Settings Section (unchanged) ========= -->
      <div class="settings-section" id="settingsSection">
        <!-- (Gi·ªØ nguy√™n ph·∫ßn form qu·∫£n l√Ω b√†i vi·∫øt nh∆∞ b·∫£n c≈© ƒë·ªÉ kh√¥ng m·∫•t ch·ª©c nƒÉng) -->
        <!-- CH·ªà r√∫t g·ªçn hi·ªÉn th·ªã cho v√≠ d·ª•; n·ªôi dung g·ªëc s·∫Ω g·ªìm c√°c input nh∆∞ mainTopic, customTitle ... -->
        <h3>‚öôÔ∏è C√†i ƒê·∫∑t B√†i Vi·∫øt (C√°c tr∆∞·ªùng nh·∫≠p nh∆∞ c≈©)</h3>
        <p style="opacity:0.7">(Ph·∫ßn form c≈© gi·ªØ nguy√™n ‚Äì m√¨nh r√∫t g·ªçn trong b·∫£n demo code)</p>
      </div>
    </div>

    <!-- ========= Status Modal ========= -->
    <div class="loading-modal" id="loadingModal" style="display:none">
      <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;text-align:center;">
        <div style="border:4px solid #fff;border-top:4px solid #007bff;border-radius:50%;width:60px;height:60px;animation:spin 1s linear infinite;margin:0 auto 20px"></div>
        <h3>ƒêang x·ª≠ l√Ω...</h3>
        <p>Vui l√≤ng ƒë·ª£i trong gi√¢y l√°t</p>
      </div>
    </div>
  </div>

  <!-- ============= SCRIPT ============= -->
  <script>
    /*---------- Helper: Byte formatter ----------*/
    function bytesToKB(bytes) { return (bytes / 1024).toFixed(1) + ' KB'; }

    /*---------- Helper: Show status ----------*/
    function showStatus(type, msg) {
      const st = document.querySelector('.status');
      st.className = 'status';
      if (type === 'success') st.classList.add('bg-success');
      else if (type === 'error') st.classList.add('bg-danger');
      else st.classList.add('bg-info');
      st.innerHTML = msg;
    }

    /*---------- Helper: Toggle loading ----------*/
    function toggleLoading(show) {
      document.getElementById('loadingModal').style.display = show ? 'block' : 'none';
    }

    /*---------- compressToWebP (resize + quality) ----------*/
    async function compressToWebP(file, quality = 0.6, maxDimension = 1920) {
      return new Promise((resolve, reject) => {
        if (!file.type.startsWith('image/')) return reject(new Error('File kh√¥ng ph·∫£i ·∫£nh'));
        const reader = new FileReader();
        const img = new Image();
        reader.onload = e => {
          img.onload = () => {
            let { width, height } = img;
            if (width > height && width > maxDimension) { height *= maxDimension / width; width = maxDimension; }
            else if (height > width && height > maxDimension) { width *= maxDimension / height; height = maxDimension; }

            const canvas = document.createElement('canvas');
            canvas.width = width; canvas.height = height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);

            canvas.toBlob(blob => {
              if (!blob) return reject(new Error('Kh√¥ng th·ªÉ n√©n WebP'));
              const webpFile = new File([blob], 'upload.webp', { type: 'image/webp' });
              resolve({ webpFile, newSize: blob.size });
            }, 'image/webp', quality);
          };
          img.onerror = reject;
          img.src = e.target.result;
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    /*---------- Imgur Integration (c√≥ n√©n tr∆∞·ªõc) ----------*/
    (function (root, factory) {
      if (typeof define === 'function' && define.amd) define([], factory);
      else if (typeof exports === 'object') module.exports = factory();
      else root.Imgur = factory();
    }(this, function () {
      function Imgur(opts) {
        if (!(this instanceof Imgur)) return new Imgur(opts);
        if (!opts.clientid) throw 'Thi·∫øu Client ID Imgur';
        this.clientid = opts.clientid;
        this.endpoint = 'https://api.imgur.com/3/image';
        this.callback = opts.callback || function () {};
        this.dropzone = document.querySelectorAll('.dropzone');
        this.init();
      }

      Imgur.prototype = {
        /* XHR Post */
        post: function (fd, cb) {
          const xhr = new XMLHttpRequest();
          xhr.open('POST', this.endpoint, true);
          xhr.setRequestHeader('Authorization', 'Client-ID ' + this.clientid);
          xhr.onreadystatechange = function () {
            if (this.readyState === 4) {
              toggleLoading(false);
              if (this.status >= 200 && this.status < 300) {
                let res = {};
                try { res = JSON.parse(this.responseText); } catch (e) { res = this.responseText; }
                cb(res);
              } else {
                showStatus('error', 'L·ªói upload: ' + this.status);
              }
            }
          };
          xhr.send(fd);
        },

        /* Match & compress each file */
        handleFile: async function (file) {
          try {
            const q = parseFloat(document.getElementById('qualityRange').value);
            toggleLoading(true);
            showStatus('info', 'ƒêang n√©n ·∫£nh...');
            const { webpFile, newSize } = await compressToWebP(file, q);
            showStatus('info', `ƒê√£ n√©n ${bytesToKB(file.size)} ‚ûú ${bytesToKB(newSize)} (<b>${Math.round(100 - newSize / file.size * 100)}%</b> gi·∫£m)`);

            const fd = new FormData();
            fd.append('image', webpFile, 'upload.webp');
            this.post(fd, this.callback.bind(this));
          } catch (err) {
            toggleLoading(false);
            showStatus('error', err.message || 'Kh√¥ng th·ªÉ x·ª≠ l√Ω file');
          }
        },

        init: function () {
          const self = this;
          this.dropzone.forEach(zone => {
            const input = zone.querySelector('input[type="file"]');

            /* change */
            zone.addEventListener('change', e => {
              Array.from(e.target.files).forEach(f => self.handleFile(f));
            });

            /* drag events */
            ['dragenter', 'dragleave', 'dragover', 'drop'].forEach(evt => {
              zone.addEventListener(evt, e => {
                e.preventDefault(); e.stopPropagation();
                if (evt === 'dragenter' || evt === 'dragover') zone.classList.add('dropzone-dragging');
                else zone.classList.remove('dropzone-dragging');
                if (evt === 'drop') Array.from(e.dataTransfer.files).forEach(f => self.handleFile(f));
              });
            });
          });
        }
      };
      return Imgur;
    }));

    /*---------- After upload callback ----------*/
    const uploadedImages = [];
    function uploadCallback(res) {
      if (res.success) {
        const url = res.data.link.replace(/^http:\/\//i, 'https://');
        uploadedImages.push(url);
        addImageItem(url);
        showStatus('success', `T·∫£i l√™n th√†nh c√¥ng (${uploadedImages.length}) ·∫£nh`);
      } else {
        showStatus('error', 'Upload th·∫•t b·∫°i');
      }
    }

    /*---------- DOM helpers ----------*/
    function addImageItem(url) {
      const wrap = document.querySelector('.uploaded-images');
      const div = document.createElement('div');
      div.className = 'image-item';
      div.innerHTML = `
        <img src="${url}" class="image-preview" alt="Uploaded" />
        <input class="image-url" value="${url}" readonly onclick="this.select()" />
        <button class="btn" style="background:#dc3545;margin-top:10px" onclick="this.parentNode.remove();">üóëÔ∏è X√≥a</button>
      `;
      wrap.appendChild(div);
    }

    /*---------- Init Imgur ----------*/
    new Imgur({ clientid: '3a8be4390ef3eb8', callback: uploadCallback });
  </script>
</body>
</html>
