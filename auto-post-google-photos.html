<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Tool Táº¡o BÃ i Viáº¿t GÃ¡i Xinh Äa Ná»n Táº£ng - PhiÃªn Báº£n HoÃ n Chá»‰nh</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --p1:#667eea; --p2:#764ba2; --text:#333; --muted:#555; --bd:#e1e5e9; --bg:#f8f9ff;
    }
    *{box-sizing:border-box}
    body{
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width:1000px; margin:auto; padding:20px;
      background:linear-gradient(135deg,var(--p1) 0%,var(--p2) 100%);
      min-height:100vh;
    }
    .container{background:#fff;border-radius:16px;padding:30px;box-shadow:0 20px 40px rgba(0,0,0,.12)}
    h1{margin:0 0 24px;text-align:center;font-size:28px;color:var(--text);
      background:linear-gradient(45deg,var(--p1),var(--p2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .feature-tabs{display:flex;margin-bottom:20px;border-radius:10px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,.08)}
    .tab-btn{flex:1;padding:14px 16px;background:#f8f9fa;border:none;cursor:pointer;font-weight:700}
    .tab-btn:focus{outline:none}
    .tab-btn.active{background:linear-gradient(45deg,var(--p1),var(--p2));color:#fff}
    .tab-content{display:none}
    .tab-content.active{display:block}
    .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-bottom:18px}
    .form-group{display:flex;flex-direction:column}
    .form-group.full-width{grid-column:1/-1}
    label{font-weight:700;margin-bottom:8px;color:var(--muted);display:flex;align-items:center;gap:8px}
    input[type=text], select, textarea{
      padding:12px;border:2px solid var(--bd);border-radius:8px;font-size:14px;transition:.2s
    }
    input[type=text]:focus, select:focus, textarea:focus{
      outline:none;border-color:var(--p1);box-shadow:0 0 0 3px rgba(102,126,234,.12)
    }
    textarea{height:220px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;resize:vertical}
    .dropzone{
      border:3px dashed var(--p1);border-radius:12px;padding:38px;text-align:center;
      color:var(--p1);cursor:pointer;background:var(--bg);transition:.2s
    }
    .dropzone.dragover{border-color:var(--p2);background:#f0f2ff;transform:scale(1.01)}
    .image-preview{margin-top:14px;text-align:center}
    .image-preview img{max-width:100%;max-height:320px;border-radius:12px;box-shadow:0 10px 26px rgba(0,0,0,.15)}
    .checks{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:10px}
    .checks .item{display:flex;align-items:center;gap:10px}
    .checks input[type=checkbox]{width:18px;height:18px;accent-color:var(--p1)}
    .actions{text-align:center;margin-top:18px}
    button{
      padding:14px 22px;border:none;border-radius:10px;cursor:pointer;font-weight:800;color:#fff;margin:8px;
      background:linear-gradient(45deg,var(--p1),var(--p2));box-shadow:0 10px 22px rgba(102,126,234,.28);
      transition:.18s transform, .18s box-shadow
    }
    button:hover{transform:translateY(-2px);box-shadow:0 14px 28px rgba(102,126,234,.35)}
    .btn-green{background:linear-gradient(45deg,#28a745,#20c997)}
    .btn-cyan{background:linear-gradient(45deg,#17a2b8,#138496)}
    .btn-red{background:linear-gradient(45deg,#dc3545,#c82333)}
    .btn-plain{background:#fff;color:#333;border:2px solid #333;box-shadow:none}
    .note{font-size:13px;color:#666}
    .loading-modal{position:fixed;inset:0;background:rgba(255,255,255,.92);backdrop-filter:blur(4px);display:none;align-items:center;justify-content:center;z-index:9999}
    .loading-modal.show{display:flex}
    .loading-content{background:#fff;padding:34px;border-radius:14px;box-shadow:0 18px 40px rgba(0,0,0,.12);text-align:center}
    .spinner{width:48px;height:48px;border:4px solid #eee;border-top:4px solid var(--p1);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 16px}
    @keyframes spin{to{transform:rotate(360deg)}}
    .topic-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;margin-top:6px}
    .topic-card{padding:14px;border:2px solid var(--bd);border-radius:10px;background:var(--bg);cursor:pointer;text-align:center;font-weight:600;transition:.18s}
    .topic-card:hover{transform:translateY(-2px);border-color:var(--p1);box-shadow:0 8px 18px rgba(102,126,234,.22)}
    .topic-card.selected{border-color:var(--p1);background:linear-gradient(45deg,var(--p1),var(--p2));color:#fff}
    .helper{padding:14px;background:#fff7e6;border:1px solid #ffe3a3;color:#8a6d3b;border-radius:10px;margin-top:8px;font-size:13px}
    /* Preview styles inside popup */
    .preview-root{max-width:860px;margin:auto;padding:18px;font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif}
    .preview-root .hero{display:block;text-align:center;margin:16px 0}
    .preview-root img,.preview-root video{max-width:100%;height:auto;border-radius:12px;box-shadow:0 8px 18px rgba(0,0,0,.12)}
    .preview-root .hashtags{color:#1da1f2;font-weight:700}
    .wm-wrap{position:relative;display:inline-block}
    .wm-overlay{
  position:absolute;
  bottom:8px;
  right:12px;
  pointer-events:none;
  opacity:.4;
  font-weight:800;
  font-size:18px;
  color:white;
  text-shadow:1px 1px 3px rgba(0,0,0,0.6);
}
    @media (max-width:720px){.form-grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¥ Tool Táº¡o BÃ i Viáº¿t GÃ¡i Xinh Äa Ná»n Táº£ng</h1>

    <!-- Tabs -->
    <div class="feature-tabs" id="tabs">
      <button class="tab-btn active" data-tab="basic">ğŸ¬ CÆ¡ Báº£n</button>
      <button class="tab-btn" data-tab="advanced">âš¡ NÃ¢ng Cao</button>
      <button class="tab-btn" data-tab="batch">ğŸ“š HÃ ng Loáº¡t</button>
    </div>

    <!-- BASIC TAB -->
    <div class="tab-content active" id="tab-basic">
      <div class="form-grid">
        <div class="form-group full-width">
          <label>ğŸ“¸ Upload áº£nh thumbnail (Imgur):</label>
          <div class="dropzone" id="dropzone">KÃ©o áº£nh vÃ o Ä‘Ã¢y hoáº·c click Ä‘á»ƒ chá»n</div>
          <div class="image-preview" id="imagePreview"></div>
          <input type="hidden" id="imgurLink" />
          <div class="note">DÃ¹ng Imgur API. Náº¿u khÃ´ng upload, báº¡n cÃ³ thá»ƒ nháº­p áº£nh trá»±c tiáº¿p á»Ÿ pháº§n video/áº£nh MP4 (há»— trá»£ .jpg/.png/.mp4).</div>
        </div>

        <div class="form-group">
          <label>ğŸ¬ Link video/áº£nh MP4 or Image URL:</label>
          <input type="text" id="mediaLink" placeholder="https://example.com/video.mp4 hoáº·c https://example.com/image.jpg" />
        </div>

        <div class="form-group">
          <label>ğŸ‘§â€â™€ï¸ TÃªn nhÃ¢n váº­t (tuá»³ chá»n):</label>
          <input type="text" id="characterName" placeholder="VÃ­ dá»¥: Ngá»c Trinh, Arisa, Lisa..." />
        </div>

        <div class="form-group">
          <label>ğŸŒ Quá»‘c gia:</label>
          <select id="country">
            <option value="Viá»‡t Nam">ğŸ‡»ğŸ‡³ Viá»‡t Nam</option>
            <option value="Nháº­t Báº£n">ğŸ‡¯ğŸ‡µ Nháº­t Báº£n</option>
            <option value="HÃ n Quá»‘c">ğŸ‡°ğŸ‡· HÃ n Quá»‘c</option>
            <option value="Trung Quá»‘c">ğŸ‡¨ğŸ‡³ Trung Quá»‘c</option>
            <option value="ThÃ¡i Lan">ğŸ‡¹ğŸ‡­ ThÃ¡i Lan</option>
            <option value="ChÃ¢u Ã‚u">ğŸ‡ªğŸ‡º ChÃ¢u Ã‚u</option>
            <option value="Má»¹">ğŸ‡ºğŸ‡¸ Má»¹</option>
          </select>
        </div>

        <div class="form-group">
          <label>âœï¸ Phong cÃ¡ch viáº¿t:</label>
          <select id="style">
            <option value="goi-cam">ğŸ”¥ Gá»£i cáº£m, quyáº¿n rÅ©</option>
            <option value="nhe-nhang">ğŸŒ¸ Nháº¹ nhÃ ng, tinh táº¿</option>
            <option value="thu-vi">ğŸ˜„ ThÃº vá»‹, hÃ i hÆ°á»›c</option>
            <option value="nghe-thuat">ğŸ¨ Nghá»‡ thuáº­t</option>
            <option value="sexy">ğŸ’‹ Sexy</option>
            <option value="cute">ğŸ˜ Cute</option>
          </select>
        </div>
      </div>

      <div class="form-group full-width">
        <label>ğŸ“š Chá»n chá»§ Ä‘á» bÃ i viáº¿t:</label>
        <div class="topic-grid" id="topicGrid"></div>
        <div class="helper">âš ï¸ KhÃ´ng há»— trá»£ chá»§ Ä‘á» liÃªn quan tráº» vá»‹ thÃ nh niÃªn. Vui lÃ²ng chá»n chá»§ Ä‘á» an toÃ n.</div>
      </div>

      <div class="form-group full-width">
        <div class="checks">
          <div class="item">
            <input type="checkbox" id="confirmAdult" />
            <label for="confirmAdult">TÃ´i xÃ¡c nháº­n ngÆ°á»i trong áº£nh/video **Ä‘Ã£ Ä‘á»§ 18 tuá»•i**.</label>
          </div>
          <div class="item">
            <input type="checkbox" id="addHashtags" checked />
            <label for="addHashtags">ThÃªm hashtags</label>
          </div>
          <div class="item">
            <input type="checkbox" id="addSEO" checked />
            <label for="addSEO">Tá»‘i Æ°u SEO (meta tags, OG)</label>
          </div>
          <div class="item">
            <input type="checkbox" id="autoplay" />
            <label for="autoplay">Video tá»± phÃ¡t (autoplay + muted)</label>
          </div>
          <div class="item">
            <input type="checkbox" id="addWatermark" />
            <label for="addWatermark">ThÃªm watermark ná»n nháº¡t trÃªn áº£nh/video</label>
          </div>
        </div>
      </div>

      <div class="actions">
        <button id="btnGenerate">ğŸ”® Táº¡o BÃ i Viáº¿t</button>
        <button class="btn-green" id="btnPreview">ğŸ‘ï¸ Xem TrÆ°á»›c</button>
      </div>
    </div>

    <!-- ADVANCED TAB -->
    <div class="tab-content" id="tab-advanced">
      <div class="form-group">
        <label>ğŸ¯ Template tuá»³ chá»‰nh:</label>
        <textarea id="customTemplate" placeholder="DÃ¹ng cÃ¡c biáº¿n: {{title}}, {{description}}, {{image}}, {{video}}, {{content}}, {{hashtags}}"></textarea>
      </div>
      <div class="form-group">
        <label>ğŸ·ï¸ Keywords SEO (phÃ¢n tÃ¡ch bá»Ÿi dáº¥u pháº©y):</label>
        <input type="text" id="seoKeywords" placeholder="gÃ¡i xinh, hot girl, beauty..." />
      </div>
      <div class="note">Náº¿u Ä‘á»ƒ trá»‘ng template, tool sáº½ dÃ¹ng template máº·c Ä‘á»‹nh Ä‘áº¹p, cÃ³ OG tags.</div>
    </div>

    <!-- BATCH TAB -->
    <div class="tab-content" id="tab-batch">
      <div class="form-group">
        <label>ğŸ“‹ Danh sÃ¡ch URL (má»—i dÃ²ng má»™t URL áº£nh hoáº·c video):</label>
        <textarea id="batchUrls" placeholder="https://example.com/image1.jpg&#10;https://example.com/video1.mp4"></textarea>
      </div>
      <div class="actions">
        <button id="btnBatch">âš¡ Xá»­ LÃ½ HÃ ng Loáº¡t</button>
      </div>
    </div>

    <div class="form-group full-width">
      <label>Káº¿t quáº£ bÃ i viáº¿t (HTML Ä‘áº§y Ä‘á»§):</label>
      <textarea id="resultHTML" readonly></textarea>
    </div>

    <div class="actions">
      <button class="btn-plain" id="btnCopy">ğŸ“„ Sao ChÃ©p HTML</button>
      <button class="btn-cyan" id="btnDownload">ğŸ’¾ Táº£i Xuá»‘ng</button>
      <button class="btn-red" id="btnClear">ğŸ—‘ï¸ XoÃ¡ Táº¥t Cáº£</button>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading-modal" id="loadingModal">
    <div class="loading-content">
      <div class="spinner"></div>
      <div>Äang xá»­ lÃ½â€¦</div>
    </div>
  </div>

  <script>
    /** ============ Cáº¤U HÃŒNH & Dá»® LIá»†U ============ **/
    const IMGUR_CLIENT_ID = '3a8be4390ef3eb8'; // thay báº±ng Client-ID cá»§a báº¡n náº¿u cáº§n

    let selectedTopic = 'hotgirl';

    // Chá»‰ giá»¯ chá»§ Ä‘á» an toÃ n, loáº¡i bá» cÃ¡c chá»§ Ä‘á» gá»£i Ã½ tráº» vá»‹ thÃ nh niÃªn
    const TOPICS = {
      'hotgirl': 'ğŸ”¥ Hot girl',
      'facebook': 'ğŸ‘¥ GÃ¡i xinh Facebook',
      'instagram': 'ğŸ“· GÃ¡i xinh Instagram',
      'twitter': 'ğŸ¦ GÃ¡i xinh Twitter',
      'tiktok': 'ğŸµ TikTok girl',
      'gai-xinh-vn': 'ğŸ‡»ğŸ‡³ áº¢nh GÃ¡i Xinh VN',
      'gai-chau-au-my': 'ğŸŒ GÃ¡i xinh ChÃ¢u Ã‚u/Má»¹',
      'gai-nhat': 'ğŸ‡¯ğŸ‡µ áº¢nh gÃ¡i Nháº­t',
      'gai-han': 'ğŸ‡°ğŸ‡· áº¢nh gÃ¡i HÃ n',
      'bikini': 'ğŸ‘™ Bikini (18+)',
      'ao-dai': 'ğŸ‘— Ão dÃ i',
      'cosplay': 'ğŸ­ Cosplay',
      'dienvien': 'ğŸ¬ Diá»…n viÃªn',
      'nguoimau': 'ğŸ“¸ NgÆ°á»i máº«u',
      'idol': 'â­ Idol',
      'influencer': 'ğŸ’« Influencer'
    };

    /** ============ TIá»†N ÃCH ============ **/
    const $ = sel => document.querySelector(sel);
    const $$ = sel => document.querySelectorAll(sel);
    const showLoading = (s) => $('#loadingModal').classList.toggle('show', !!s);
    const isVideo = (url) => /\.mp4($|\?)/i.test(url);
    const isImage = (url) => /\.(png|jpe?g|webp|gif)($|\?)/i.test(url);

    function safeReplaceAll(template, map){
      let out = template;
      Object.entries(map).forEach(([k,v])=>{
        const re = new RegExp(`\\{\\{${k}\\}\\}`,'g');
        out = out.replace(re, v ?? '');
      });
      return out;
    }

    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    /** ============ Ná»˜I DUNG Tá»° Äá»˜NG ============ **/
    function generateEnhancedContent(topic, subject, country, style){
      const blocks = {
        'goi-cam': {
          intro: [
            `${subject} xuáº¥t hiá»‡n Ä‘áº§y quyáº¿n rÅ© trong bá»™ áº£nh má»›i.`,
            `Váº» Ä‘áº¹p nÃ³ng bá»ng cá»§a ${subject} khiáº¿n ngÆ°á»i xem khÃ´ng thá»ƒ rá»i máº¯t.`
          ],
          body: [
            `Tháº§n thÃ¡i tá»± tin vÃ  phong cÃ¡ch thá»i trang tinh táº¿ lÃ m báº­t lÃªn nÃ©t cuá»‘n hÃºt cá»§a ${subject}.`,
            `Má»—i khung hÃ¬nh Ä‘á»u toÃ¡t lÃªn sá»± gá»£i cáº£m nhÆ°ng váº«n sang trá»ng.`
          ]
        },
        'nhe-nhang': {
          intro: [
            `${subject} toÃ¡t lÃªn váº» dá»‹u dÃ ng vÃ  tinh táº¿.`,
            `NÃ©t Ä‘áº¹p tá»± nhiÃªn cá»§a ${subject} mang láº¡i cáº£m giÃ¡c dá»… chá»‹u ngay tá»« Ã¡nh nhÃ¬n Ä‘áº§u tiÃªn.`
          ],
          body: [
            `Gam mÃ u nháº¹ nhÃ ng vÃ  bá»‘ cá»¥c tá»‘i giáº£n giÃºp tÃ´n lÃªn gÆ°Æ¡ng máº·t xinh xáº¯n cá»§a ${subject}.`,
            `Ná»¥ cÆ°á»i ráº¡ng rá»¡ chÃ­nh lÃ  Ä‘iá»ƒm nháº¥n lÃ m say lÃ²ng ngÆ°á»i xem.`
          ]
        },
        'thu-vi': {
          intro: [
            `${subject} mang Ä‘áº¿n nÄƒng lÆ°á»£ng tÃ­ch cá»±c vá»›i phong cÃ¡ch tráº» trung.`,
            `Nhá»¯ng khoáº£nh kháº¯c ngáº«u há»©ng cá»§a ${subject} khiáº¿n bá»™ áº£nh trÃ n Ä‘áº§y sá»©c sá»‘ng.`
          ],
          body: [
            `CÃ¡ch táº¡o dÃ¡ng tá»± nhiÃªn, biá»ƒu cáº£m Ä‘a dáº¡ng táº¡o nÃªn series áº£nh Ä‘áº§y thÃº vá»‹.`,
            `Má»—i bá»©c áº£nh lÃ  má»™t cÃ¢u chuyá»‡n nhá» Ä‘Ã¡ng yÃªu vá» ${subject}.`
          ]
        },
        'nghe-thuat': {
          intro: [
            `Bá»™ áº£nh cá»§a ${subject} gÃ¢y áº¥n tÆ°á»£ng máº¡nh vá»›i bá»‘ cá»¥c vÃ  Ã¡nh sÃ¡ng Ä‘áº§y tÃ­nh nghá»‡ thuáº­t.`,
            `Phong cÃ¡ch thá»‹ giÃ¡c tá»‘i giáº£n nhÆ°ng sÃ¢u sáº¯c tÃ´n lÃªn váº» Ä‘áº¹p ${country.toLowerCase()}.`
          ],
          body: [
            `Tá»«ng chi tiáº¿t Ä‘á»u Ä‘Æ°á»£c chÄƒm chÃºt ká»¹ lÆ°á»¡ng, táº¡o nÃªn cáº£m xÃºc thá»‹ giÃ¡c Ä‘áº·c biá»‡t.`,
            `Sá»± hÃ²a quyá»‡n giá»¯a mÃ u sáº¯c vÃ  cháº¥t liá»‡u táº¡o nÃªn tá»•ng thá»ƒ tinh táº¿.`
          ]
        },
        'sexy': {
          intro: [
            `${subject} khoe trá»n Ä‘Æ°á»ng cong nÃ³ng bá»ng trong concept Ä‘áº§y tÃ¡o báº¡o (18+).`,
            `Sá»©c hÃºt khÃ³ cÆ°á»¡ng cá»§a ${subject} khiáº¿n cá»™ng Ä‘á»“ng máº¡ng â€œÄ‘á»©ng ngá»“i khÃ´ng yÃªnâ€.`
          ],
          body: [
            `Tuy gá»£i cáº£m nhÆ°ng tá»«ng khung hÃ¬nh váº«n giá»¯ sá»± chá»‰n chu vÃ  tháº©m má»¹.`,
            `Sá»± tá»± tin lÃ  â€œvÅ© khÃ­â€ giÃºp ${subject} toáº£ sÃ¡ng trong má»i gÃ³c mÃ¡y.`
          ]
        },
        'cute': {
          intro: [
            `${subject} Ä‘Ã¡ng yÃªu háº¿t náº¥c vá»›i biá»ƒu cáº£m ngá»t ngÃ o.`,
            `Phong cÃ¡ch tráº» trung vÃ  tÆ°Æ¡i táº¯n cá»§a ${subject} ghi Ä‘iá»ƒm tuyá»‡t Ä‘á»‘i.`
          ],
          body: [
            `TÃ´ng mÃ u tÆ°Æ¡i sÃ¡ng vÃ  concept gáº§n gÅ©i khiáº¿n bá»™ áº£nh dá»… thÆ°Æ¡ng vÃ´ cÃ¹ng.`,
            `Má»—i khoáº£nh kháº¯c Ä‘á»u toÃ¡t lÃªn nÃ©t Ä‘Ã¡ng yÃªu khÃ³ cÆ°á»¡ng.`
          ]
        }
      };
      const t = blocks[style] || blocks['nhe-nhang'];
      const intro = pick(t.intro);
      const bodies = t.body.map(p=>`<p>${p}</p>`).join('');
      return `<p>${intro}</p>${bodies}`;
    }

    function generateTitle(topic, subject, country){
      const map = {
        'facebook': `áº¢nh Facebook ${subject} - GÃ¡i xinh ${country} gÃ¢y sá»‘t`,
        'instagram': `Instagram ${subject} - Bá»™ áº£nh gÃ¡i xinh ${country}`,
        'twitter': `Twitter ${subject} - Khoáº£nh kháº¯c gÃ¢y chÃº Ã½`,
        'tiktok': `TikTok ${subject} - Video viral cá»§a gÃ¡i xinh ${country}`,
        'bikini': `Bá»™ áº£nh bikini ${subject} (18+) - NÃ³ng bá»ng vÃ  cuá»‘n hÃºt`,
        'ao-dai': `${subject} diá»‡n Ã¡o dÃ i - Váº» Ä‘áº¹p truyá»n thá»‘ng Viá»‡t Nam`,
        'cosplay': `Cosplay ${subject} - HÃ³a thÃ¢n áº¥n tÆ°á»£ng`,
      };
      return map[topic] || `áº¢nh ${subject} - GÃ¡i xinh ${country}`;
    }

    function generateDescription(topic, subject, country){
      return `Xem bá»™ sÆ°u táº­p ${subject} - gÃ¡i xinh ${country}: hÃ¬nh áº£nh cháº¥t lÆ°á»£ng cao, ná»™i dung chá»n lá»c, phong cÃ¡ch cuá»‘n hÃºt.`;
    }

    function generateHashtags(topic, country){
      const base = ['#gaixinh','#hotgirl','#beauty','#xinh','#dep'];
      const map = {
        'facebook':['#facebook','#social'],
        'instagram':['#instagram','#insta'],
        'twitter':['#twitter'],
        'tiktok':['#tiktok','#video','#viral'],
        'bikini':['#bikini','#summer'],
        'cosplay':['#cosplay','#anime']
      };
      const countryTag = `#${country.normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/\s+/g,'').toLowerCase()}`;
      const tags = [...base, ...(map[topic]||[]), countryTag];
      return `<p class="hashtags">${[...new Set(tags)].join(' ')}</p>`;
    }

    /** ============ TEMPLATE & XUáº¤T HTML ============ **/
    function buildHTML({title, description, image, video, content, hashtags, addSEO, autoplay, watermarkText=''}){
      const seo = addSEO ? `
<meta name="keywords" content="gÃ¡i xinh, hot girl, beauty, ${selectedTopic}">
<meta name="description" content="${description}">
<meta property="og:title" content="${title}">
<meta property="og:description" content="${description}">
<meta property="og:type" content="article">
<meta property="og:image" content="${image || ''}">
` : '';

      const wmWrapOpen = watermarkText ? `<div class="wm-wrap">` : '';
      const wmOverlay = watermarkText ? `<div class="wm-overlay">${watermarkText}</div>` : '';
      const wmWrapClose = watermarkText ? `</div>` : '';

      const heroImg = image ? `
<div class="hero">
  ${wmWrapOpen}
  <img src="${image}" alt="${title}">
  ${wmOverlay}
  ${wmWrapClose}
</div>` : '';

      const heroVideo = video ? `
<div class="hero">
  ${wmWrapOpen}
  <video controls ${autoplay ? 'autoplay muted playsinline' : ''} loop poster="${image || ''}">
    <source src="${video}" type="video/mp4">
    TrÃ¬nh duyá»‡t cá»§a báº¡n khÃ´ng há»— trá»£ video.
  </video>
  ${wmOverlay}
  ${wmWrapClose}
</div>` : '';

      return `
<!-- ===== SEO ===== -->
${seo}
<!-- ===== TITLE ===== -->
<h1>${title}</h1>

<!-- ===== MEDIA ===== -->
${heroImg}
${heroVideo}

<!-- ===== CONTENT ===== -->
<div style="line-height:1.65;font-size:16px">${content}</div>

<!-- ===== TAGS ===== -->
${hashtags}

<!-- ===== RELATED ===== -->
<div style="margin-top:34px;padding:18px;background:#f8f9ff;border-radius:12px">
  <h3 style="color:#667eea;margin-top:0">ğŸ”— BÃ i viáº¿t liÃªn quan</h3>
  <ul style="line-height:1.9;margin:0;padding-left:18px">
    <li><a href="#" style="color:#667eea;text-decoration:none">Top áº£nh ${selectedTopic} Ä‘áº¹p nháº¥t</a></li>
    <li><a href="#" style="color:#667eea;text-decoration:none">Xu hÆ°á»›ng chá»¥p áº£nh ${new Date().getFullYear()}</a></li>
    <li><a href="#" style="color:#667eea;text-decoration:none">BÃ­ quyáº¿t táº¡o dÃ¡ng tÃ´n dÃ¡ng</a></li>
  </ul>
</div>
      `.trim();
    }

    function renderWithTemplate(customTpl, data){
      if(!customTpl) return buildHTML(data);
      return safeReplaceAll(customTpl, {
        title: data.title,
        description: data.description,
        image: data.image || '',
        video: data.video || '',
        content: data.content,
        hashtags: data.hashtags
      });
    }

    /** ============ UI KHá»I Táº O ============ **/
    function initTopics(){
      const grid = $('#topicGrid');
      grid.innerHTML = '';
      Object.entries(TOPICS).forEach(([key, label])=>{
        const card = document.createElement('div');
        card.className = 'topic-card' + (key===selectedTopic?' selected':'');
        card.textContent = label;
        card.addEventListener('click', (e)=>{
          selectedTopic = key;
          $$('.topic-card').forEach(c=>c.classList.remove('selected'));
          e.currentTarget.classList.add('selected');
        });
        grid.appendChild(card);
      });
    }

    function initTabs(){
      const tabs = $('#tabs');
      tabs.addEventListener('click', (e)=>{
        const btn = e.target.closest('button[data-tab]');
        if(!btn) return;
        $$('.tab-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');

        const id = 'tab-' + btn.dataset.tab;
        $$('.tab-content').forEach(c=>c.classList.remove('active'));
        $('#'+id).classList.add('active');
      });
    }

    /** ============ DROPZONE / IMGUR UPLOAD ============ **/
    function initDropzone(){
      const dz = $('#dropzone');
      dz.addEventListener('dragover', e=>{ e.preventDefault(); dz.classList.add('dragover'); });
      dz.addEventListener('dragleave', ()=> dz.classList.remove('dragover'));
      dz.addEventListener('drop', (e)=>{
        e.preventDefault();
        dz.classList.remove('dragover');
        const file = e.dataTransfer.files?.[0];
        if(file) uploadToImgur(file);
      });
      dz.addEventListener('click', ()=>{
        const input = document.createElement('input');
        input.type = 'file'; input.accept='image/*';
        input.onchange = ()=>{ if(input.files?.[0]) uploadToImgur(input.files[0]); };
        input.click();
      });
    }

    async function uploadToImgur(file){
      if(!file.type.startsWith('image/')) return alert('Vui lÃ²ng chá»n file áº£nh!');
      showLoading(true);
      try{
        const formData = new FormData();
        formData.append('image', file);
        const res = await fetch('https://api.imgur.com/3/image', {
          method: 'POST',
          headers: { Authorization: 'Client-ID ' + IMGUR_CLIENT_ID },
          body: formData
        });
        const data = await res.json();
        if(data?.success){
          const link = data.data.link;
          $('#imgurLink').value = link;
          $('#imagePreview').innerHTML = `<img src="${link}" alt="Thumbnail">`;
        } else {
          alert('Upload tháº¥t báº¡i. Vui lÃ²ng thá»­ láº¡i!');
        }
      }catch(err){
        console.error(err);
        alert('Lá»—i káº¿t ná»‘i khi upload Imgur.');
      }finally{
        showLoading(false);
      }
    }

    /** ============ Táº O BÃ€I VIáº¾T ============ **/
    function getInputs(){
      const img = $('#imgurLink').value.trim();
      const media = $('#mediaLink').value.trim();
      const name = $('#characterName').value.trim();
      const country = $('#country').value;
      const style = $('#style').value;
      const addHashtags = $('#addHashtags').checked;
      const addSEO = $('#addSEO').checked;
      const autoplay = $('#autoplay').checked;
      const addWatermark = $('#addWatermark').checked;
      const confirmAdult = $('#confirmAdult').checked;
      const customTemplate = $('#customTemplate').value.trim();
      const seoKeywords = $('#seoKeywords').value.trim();
      return {img, media, name, country, style, addHashtags, addSEO, autoplay, addWatermark, customTemplate, seoKeywords, confirmAdult};
    }

    function validateSingle({img, media, confirmAdult}){
      if(!confirmAdult){
        alert('Báº¡n pháº£i xÃ¡c nháº­n ngÆ°á»i trong áº£nh/video Ä‘Ã£ Ä‘á»§ 18 tuá»•i.');
        return false;
      }
      if(!img && !media){
        alert('Vui lÃ²ng upload áº£nh báº±ng Imgur hoáº·c nháº­p URL áº£nh/video!');
        return false;
      }
      if(media && !(isVideo(media) || isImage(media))){
        // Cho phÃ©p nhÆ°ng cáº£nh bÃ¡o Ä‘á»ƒ ngÆ°á»i dÃ¹ng kiá»ƒm tra
        if(!confirm('URL khÃ´ng cÃ³ Ä‘uÃ´i phá»• biáº¿n (.mp4/.jpg/.png/.webp). Váº«n tiáº¿p tá»¥c?')) return false;
      }
      return true;
    }

    function makeArticle({img, media, name, country, style, addHashtags, addSEO, autoplay, addWatermark, customTemplate, seoKeywords}){
      const subject = name || `cÃ´ gÃ¡i ${country.toLowerCase()}`;
      const title = generateTitle(selectedTopic, subject, country);
      const description = generateDescription(selectedTopic, subject, country);
      const content = generateEnhancedContent(selectedTopic, subject, country, style);
      const hashtags = addHashtags ? generateHashtags(selectedTopic, country) : '';

      const image = img || (isImage(media) ? media : '');
      const video = isVideo(media) ? media : '';

      // Gáº¯n thÃªm keyword náº¿u user nháº­p
      const descPlus = seoKeywords ? `${description} Tá»« khoÃ¡: ${seoKeywords}.` : description;

      const result = renderWithTemplate(customTemplate, {
        title, description: descPlus, image, video, content, hashtags
      });

      // Náº¿u dÃ¹ng template máº·c Ä‘á»‹nh, buildHTML Ä‘Ã£ lÃ m rá»“i; cÃ²n náº¿u custom template, khÃ´ng cÃ³ CSS preview => ta khÃ´ng thÃªm gÃ¬ á»Ÿ Ä‘Ã¢y
      // Watermark chá»‰ Ã¡p dá»¥ng khi dÃ¹ng template máº·c Ä‘á»‹nh (vÃ¬ custom cÃ³ thá»ƒ tá»± xá»­ lÃ½)
      if(!customTemplate){
        return buildHTML({
          title, description: descPlus, image, video, content, hashtags,
          addSEO, autoplay, watermarkText: addWatermark ? 'Girlxinh.net' : ''
        });
      }
      return result;
    }

    /** ============ Sá»° KIá»†N CHÃNH ============ **/
    async function onGenerate(){
      const state = getInputs();
      if(!validateSingle(state)) return;
      showLoading(true);
      // mÃ´ phá»ng xá»­ lÃ½
      setTimeout(()=>{
        const html = makeArticle(state);
        $('#resultHTML').value = wrapPreviewHTML(html); // LÆ°u full Ä‘á»ƒ preview Ä‘áº¹p
        showLoading(false);
      }, 400);
    }

    function onPreview(){
      const content = $('#resultHTML').value.trim();
      if(!content) return alert('Vui lÃ²ng táº¡o bÃ i viáº¿t trÆ°á»›c!');
      const w = window.open('', '_blank');
      w.document.write(content);
      w.document.close();
    }

    function onCopy(){
      const text = $('#resultHTML').value;
      if(!text) return alert('KhÃ´ng cÃ³ ná»™i dung Ä‘á»ƒ sao chÃ©p!');
      if(navigator.clipboard?.writeText){
        navigator.clipboard.writeText(text).then(()=>alert('âœ… ÄÃ£ sao chÃ©p HTML!')).catch(()=>fallbackCopy());
      }else{ fallbackCopy(); }
      function fallbackCopy(){
        const ta = $('#resultHTML'); ta.removeAttribute('readonly'); ta.select();
        document.execCommand('copy'); ta.setAttribute('readonly','');
        alert('âœ… ÄÃ£ sao chÃ©p HTML!');
      }
    }

    function onDownload(){
      const content = $('#resultHTML').value;
      if(!content) return alert('KhÃ´ng cÃ³ ná»™i dung Ä‘á»ƒ táº£i xuá»‘ng!');
      const blob = new Blob([content], {type:'text/html'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = `bai-viet-gaixinh-${Date.now()}.html`;
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    }

    function onClear(){
      if(!confirm('Báº¡n cÃ³ cháº¯c muá»‘n xoÃ¡ táº¥t cáº£?')) return;
      $('#imgurLink').value = '';
      $('#mediaLink').value = '';
      $('#characterName').value = '';
      $('#resultHTML').value = '';
      $('#imagePreview').innerHTML = '';
      $('#customTemplate').value = '';
      $('#seoKeywords').value = '';
      $('#batchUrls').value = '';
      $('#confirmAdult').checked = false;
      $('#addHashtags').checked = true;
      $('#addSEO').checked = true;
      $('#autoplay').checked = false;
      $('#addWatermark').checked = false;
      selectedTopic = 'hotgirl';
      initTopics();
      // vá» tab basic
      $$('.tab-btn').forEach(b=>b.classList.remove('active'));
      $$('.tab-content').forEach(c=>c.classList.remove('active'));
      document.querySelector('[data-tab="basic"]').classList.add('active');
      $('#tab-basic').classList.add('active');
    }

    function wrapPreviewHTML(inner){
      // Bá»c thÃªm HTML + CSS nháº¹ Ä‘á»ƒ preview má»Ÿ tab má»›i hiá»ƒn thá»‹ Ä‘áº¹p
      return `
<!doctype html><html><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Preview</title>
<style>
  .preview-root{max-width:860px;margin:auto;padding:18px;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .preview-root .hero{display:block;text-align:center;margin:16px 0}
  .preview-root img,.preview-root video{max-width:100%;height:auto;border-radius:12px;box-shadow:0 8px 18px rgba(0,0,0,.12)}
  .preview-root .hashtags{color:#1da1f2;font-weight:700}
  .wm-wrap{position:relative;display:inline-block}
  .wm-overlay{
  position:absolute;
  bottom:8px;
  right:12px;
  pointer-events:none;
  opacity:.4;
  font-weight:800;
  font-size:18px;
  color:white;
  text-shadow:1px 1px 3px rgba(0,0,0,0.6);
}
</style>
</head><body><div class="preview-root">
${inner}
</div></body></html>
`.trim();
    }

    /** ============ HÃ€NG LOáº T ============ **/
    function onBatch(){
      const list = $('#batchUrls').value.trim().split('\n').map(s=>s.trim()).filter(Boolean);
      if(!list.length) return alert('Vui lÃ²ng nháº­p danh sÃ¡ch URL!');
      if(!$('#confirmAdult').checked) return alert('Báº¡n pháº£i xÃ¡c nháº­n 18+ (Ã¡p dá»¥ng cho táº¥t cáº£ URL).');

      const base = getInputs(); // láº¥y country/style/template/â€¦ hiá»‡n táº¡i
      showLoading(true);
      setTimeout(()=>{
        const results = [];
        list.forEach((url, idx)=>{
          const state = {
            ...base,
            media: url,
            img: '', // Æ°u tiÃªn url dÃ²ng
            name: `gÃ¡i xinh #${idx+1}`
          };
          const html = makeArticle(state);
          results.push(html);
        });
        $('#resultHTML').value = wrapPreviewHTML(results.join('\n\n<!-- ========== ARTICLE SEPARATOR ========== -->\n\n'));
        showLoading(false);
        alert(`âœ… ÄÃ£ xá»­ lÃ½ ${list.length} má»¥c!`);
      }, 500);
    }

    /** ============ KHá»I Táº O  ============ **/
    function init(){
      initTabs();
      initTopics();
      initDropzone();

      // NÃºt
      $('#btnGenerate').addEventListener('click', onGenerate);
      $('#btnPreview').addEventListener('click', onPreview);
      $('#btnCopy').addEventListener('click', onCopy);
      $('#btnDownload').addEventListener('click', onDownload);
      $('#btnClear').addEventListener('click', onClear);
      $('#btnBatch').addEventListener('click', onBatch);

      // Auto-save vÃ i trÆ°á»ng
      ['characterName','mediaLink','customTemplate','seoKeywords','batchUrls'].forEach(id=>{
        const el = $('#'+id);
        const saved = localStorage.getItem('sav_'+id);
        if(saved) el.value = saved;
        el.addEventListener('input', ()=> localStorage.setItem('sav_'+id, el.value));
      });

      // PhÃ­m táº¯t
      document.addEventListener('keydown',(e)=>{
        if(!(e.ctrlKey||e.metaKey)) return;
        if(e.key.toLowerCase()==='enter'){ e.preventDefault(); onGenerate(); }
        if(e.key.toLowerCase()==='s'){ e.preventDefault(); onDownload(); }
        if(e.shiftKey && e.key.toLowerCase()==='c'){ e.preventDefault(); onCopy(); }
      });
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
