<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Tool x·ª≠ l√Ω ·∫£nh SEO + Vi·∫øt b√†i AI cho Blogger</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 900px; margin: auto; }
    img { max-width: 150px; border: 1px solid #ccc; margin: 5px; }
    .preview-wrapper { display: flex; flex-wrap: wrap; gap: 10px; }
    textarea, input[type=text] { width: 100%; box-sizing: border-box; }
    textarea { height: 150px; margin-top: 10px; }
    button { margin-top: 10px; margin-right: 10px; padding: 8px 15px; }
    #aiOutput { height: 300px; }
    .copy-button { background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .copy-button:hover { background-color: #45a049; }
    .copy-success { color: green; font-weight: bold; margin-left: 10px; }
    .output-section { position: relative; }
  </style>
</head>
<body>
  <h2>üõ†Ô∏è Tool X·ª≠ L√Ω ·∫¢nh SEO + Watermark + Vi·∫øt B√†i AI cho Blogger</h2>

  <section>
    <h3>1. X·ª≠ l√Ω ·∫£nh</h3>
    <p>üì§ <strong>Ch·ªçn ·∫£nh:</strong></p>
    <input type="file" id="imageInput" accept="image/*" multiple /><br /><br />

    <p>üîë <strong>T·ª´ kh√≥a SEO:</strong></p>
    <input type="text" id="keywordInput" placeholder="V√≠ d·ª•: Qu·ª≥nh Alee bikini" /><br /><br />

    <p>üñºÔ∏è <strong>ƒê·ªãnh d·∫°ng ·∫£nh:</strong></p>
    <select id="formatSelect">
      <option value="jpeg">JPEG</option>
      <option value="webp">WebP</option>
    </select><br /><br />

    <p>üîñ <strong>Ch·ªçn watermark (PNG):</strong></p>
    <input type="file" id="watermarkInput" accept="image/png" /><br /><br />

    <button onclick="processImages()">üî• X·ª≠ l√Ω ·∫£nh & T·∫£i v·ªÅ</button>
    <button onclick="generateHtml()">üìã Sinh HTML ch√®n Blogger</button><br /><br />

    <div class="preview-wrapper" id="preview"></div>

    <div class="output-section">
      <h3>üìÑ M√£ HTML ƒë·ªÉ d√°n v√†o b√†i Blogger:</h3>
      <button class="copy-button" onclick="copyHtml()">üìã Copy HTML</button>
      <span id="htmlCopyStatus" class="copy-success"></span>
      <textarea id="htmlOutput" readonly></textarea>
    </div>
  </section>

  <hr />

  <section>
    <h3>2. Vi·∫øt b√†i t·ª± ƒë·ªông b·∫±ng AI</h3>
    <p>üìù <strong>Nh·∫≠p ch·ªß ƒë·ªÅ ho·∫∑c ti√™u ƒë·ªÅ b√†i vi·∫øt:</strong></p>
    <input type="text" id="aiTopicInput" placeholder="V√≠ d·ª•: Du l·ªãch ƒê√† N·∫µng n√™n ƒëi ƒë√¢u?" /><br />
    <button onclick="generateAIArticle()">ü§ñ T·∫°o b√†i vi·∫øt t·ª± ƒë·ªông</button><br />
    <p id="aiStatus" style="color: green; font-weight: bold;"></p>
    
    <div class="output-section">
      <button class="copy-button" onclick="copyAIContent()">üìã Copy b√†i vi·∫øt</button>
      <span id="aiCopyStatus" class="copy-success"></span>
      <textarea id="aiOutput" placeholder="N·ªôi dung b√†i vi·∫øt t·ª± ƒë·ªông s·∫Ω hi·ªán ·ªü ƒë√¢y..."></textarea>
    </div>
  </section>

  <script>
    // H√†m chuy·ªÉn chu·ªói ti·∫øng Vi·ªát c√≥ d·∫•u sang kh√¥ng d·∫•u, v√† thay kho·∫£ng tr·∫Øng th√†nh d·∫•u '-'
    function removeVietnamese(str) {
      str = str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
      str = str.replace(/ƒë/g, "d").replace(/ƒê/g, "D");
      str = str.replace(/[^a-zA-Z0-9\s]/g, "");
      return str.trim().replace(/\s+/g, "-").toLowerCase();
    }

    // X·ª≠ l√Ω ·∫£nh gi·ªëng nh∆∞ b·∫£n tr∆∞·ªõc
    function processImages() {
      const images = document.getElementById("imageInput").files;
      const keyword = document.getElementById("keywordInput").value.trim();
      const format = document.getElementById("formatSelect").value;
      const watermarkFile = document.getElementById("watermarkInput").files[0];

      if (!images.length || !keyword) {
        alert("Vui l√≤ng ch·ªçn ·∫£nh v√† nh·∫≠p t·ª´ kh√≥a.");
        return;
      }

      const cleanName = removeVietnamese(keyword);
      const preview = document.getElementById("preview");
      preview.innerHTML = "";

      Array.from(images).forEach((image, index) => {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = new Image();
          img.onload = function() {
            const maxWidth = 1200;
            let scale = 1;
            if (img.width > maxWidth) {
              scale = maxWidth / img.width;
            }
            const canvas = document.createElement("canvas");
            canvas.width = img.width * scale;
            canvas.height = img.height * scale;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

            if (watermarkFile) {
              const wmReader = new FileReader();
              wmReader.onload = function(ev) {
                const wmImg = new Image();
                wmImg.onload = function() {
                  const wmScale = 0.2 * scale;
                  const wmWidth = wmImg.width * wmScale;
                  const wmHeight = wmImg.height * wmScale;
                  ctx.drawImage(wmImg, canvas.width - wmWidth - 10, canvas.height - wmHeight - 10, wmWidth, wmHeight);
                  exportImage(canvas, cleanName, index, format, preview);
                };
                wmImg.src = ev.target.result;
              };
              wmReader.readAsDataURL(watermarkFile);
            } else {
              exportImage(canvas, cleanName, index, format, preview);
            }
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(image);
      });
    }

    function exportImage(canvas, baseName, index, format, preview) {
      if (!canvas.toBlob) {
        alert("Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ t√≠nh nƒÉng n√†y.");
        return;
      }
      canvas.toBlob(function(blob) {
        const fileName = `${baseName}-${index + 1}.${format}`;
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        a.remove();

        const imgTag = document.createElement("img");
        imgTag.src = url;
        imgTag.title = fileName;
        imgTag.alt = fileName;
        preview.appendChild(imgTag);

        setTimeout(() => {
          URL.revokeObjectURL(url);
        }, 300000);
      }, `image/${format}`, 0.9);
    }

    function generateHtml() {
      const imgs = document.querySelectorAll("#preview img");
      let html = "";
      imgs.forEach(img => {
        html += `<img src="${img.src}" alt="${img.alt}" title="${img.title}" style="max-width:100%;" /><br>\n`;
      });
      document.getElementById("htmlOutput").value = html;
    }

    // H√†m copy HTML
    function copyHtml() {
      const htmlOutput = document.getElementById("htmlOutput");
      const htmlCopyStatus = document.getElementById("htmlCopyStatus");
      
      if (htmlOutput.value.trim() === "") {
        alert("Ch∆∞a c√≥ m√£ HTML ƒë·ªÉ copy. Vui l√≤ng x·ª≠ l√Ω ·∫£nh tr∆∞·ªõc.");
        return;
      }
      
      htmlOutput.select();
      htmlOutput.setSelectionRange(0, 99999); // Cho mobile
      
      try {
        document.execCommand('copy');
        htmlCopyStatus.textContent = "‚úÖ ƒê√£ copy!";
        setTimeout(() => {
          htmlCopyStatus.textContent = "";
        }, 2000);
      } catch (err) {
        // Fallback cho tr√¨nh duy·ªát hi·ªán ƒë·∫°i
        navigator.clipboard.writeText(htmlOutput.value).then(() => {
          htmlCopyStatus.textContent = "‚úÖ ƒê√£ copy!";
          setTimeout(() => {
            htmlCopyStatus.textContent = "";
          }, 2000);
        }).catch(() => {
          alert("Kh√¥ng th·ªÉ copy. Vui l√≤ng copy th·ªß c√¥ng.");
        });
      }
    }

    // H√†m copy n·ªôi dung AI
    function copyAIContent() {
      const aiOutput = document.getElementById("aiOutput");
      const aiCopyStatus = document.getElementById("aiCopyStatus");
      
      if (aiOutput.value.trim() === "") {
        alert("Ch∆∞a c√≥ n·ªôi dung b√†i vi·∫øt ƒë·ªÉ copy. Vui l√≤ng t·∫°o b√†i vi·∫øt tr∆∞·ªõc.");
        return;
      }
      
      aiOutput.select();
      aiOutput.setSelectionRange(0, 99999); // Cho mobile
      
      try {
        document.execCommand('copy');
        aiCopyStatus.textContent = "‚úÖ ƒê√£ copy!";
        setTimeout(() => {
          aiCopyStatus.textContent = "";
        }, 2000);
      } catch (err) {
        // Fallback cho tr√¨nh duy·ªát hi·ªán ƒë·∫°i
        navigator.clipboard.writeText(aiOutput.value).then(() => {
          aiCopyStatus.textContent = "‚úÖ ƒê√£ copy!";
          setTimeout(() => {
            aiCopyStatus.textContent = "";
          }, 2000);
        }).catch(() => {
          alert("Kh√¥ng th·ªÉ copy. Vui l√≤ng copy th·ªß c√¥ng.");
        });
      }
    }

    // --- Ph·∫ßn AI vi·∫øt b√†i t·ª± ƒë·ªông ---
    async function generateAIArticle() {
      const topic = document.getElementById("aiTopicInput").value.trim();
      const aiStatus = document.getElementById("aiStatus");
      const aiOutput = document.getElementById("aiOutput");

      if (!topic) {
        alert("Vui l√≤ng nh·∫≠p ch·ªß ƒë·ªÅ b√†i vi·∫øt.");
        return;
      }

      aiStatus.textContent = "ƒêang t·∫°o b√†i vi·∫øt... vui l√≤ng ch·ªù trong gi√¢y l√°t.";
      aiOutput.value = "";

      // Thay YOUR_OPENAI_API_KEY b·∫±ng API key th·∫≠t c·ªßa b·∫°n
      const apiKey = "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";

      const prompt = `Vi·∫øt m·ªôt b√†i vi·∫øt chi ti·∫øt chu·∫©n SEO b·∫±ng ti·∫øng Vi·ªát v·ªÅ ch·ªß ƒë·ªÅ: "${topic}". B√†i vi·∫øt n√™n d√†i kho·∫£ng 300-500 t·ª´, c√≥ ƒëo·∫°n m·ªü ƒë·∫ßu h·∫•p d·∫´n, c√°c ƒëo·∫°n th√¢n b√†i r√µ r√†ng, k·∫øt lu·∫≠n s√∫c t√≠ch.`;

      try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: "gpt-4o-mini",
            messages: [{ role: "user", content: prompt }],
            temperature: 0.7,
            max_tokens: 700,
          })
        });

        if (!response.ok) {
          throw new Error(`L·ªói API: ${response.status} ${response.statusText}`);
        }

        const data = await response.json();
        const text = data.choices && data.choices[0] && data.choices[0].message.content;
        if (text) {
          aiOutput.value = text.trim();
          aiStatus.textContent = "T·∫°o b√†i vi·∫øt th√†nh c√¥ng!";
        } else {
          aiOutput.value = "";
          aiStatus.textContent = "Kh√¥ng nh·∫≠n ƒë∆∞·ª£c n·ªôi dung tr·∫£ v·ªÅ.";
        }

      } catch (error) {
        aiStatus.textContent = "C√≥ l·ªói x·∫£y ra: " + error.message;
        aiOutput.value = "";
      }
    }
  </script>
</body>
</html>
