<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Tool SEO AI Tự Động</title>
</head>
<body>

<!-- ✅ Tích hợp AI vào Tool SEO: Gồm caption ảnh AI, mở bài AI, hashtag AI -->
<!-- 🌟 Chèn đoạn này vào trong phần <body> -->

<div style="margin-top: 20px;">
  <button class="btn btn-success" onclick="generateIntroFromAI()">✍️ AI Viết Mở Bài</button>
  <button class="btn btn-warning" onclick="suggestHashtagsFromAI()">🎯 AI Gợi Ý Hashtag</button>
</div>

<script>
const OPENAI_PROXY_URL = "http://localhost:3001/openai";

async function callOpenAI(messages) {
  const res = await fetch(OPENAI_PROXY_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ messages })
  });
  const data = await res.json();
  return data.choices?.[0]?.message?.content.trim() || "Không có phản hồi từ AI.";
}

// 🖼️ Caption ảnh AI
async function generateImageCaptionAI(imageUrl, keyword) {
  return await callOpenAI([
    { role: "system", content: "Bạn là chuyên gia viết caption ảnh cho bài viết SEO" },
    { role: "user", content: `Viết caption ảnh ngắn (dưới 20 từ), hấp dẫn cho ảnh sau: ${imageUrl}, theo chủ đề "${keyword}".` }
  ]);
}

// ✍️ Đoạn mở bài AI
async function generateSEOBodyAI(topic, keyword, description) {
  return await callOpenAI([
    { role: "system", content: "Bạn là chuyên gia viết bài SEO tiếng Việt." },
    { role: "user", content: `Viết đoạn mở đầu hấp dẫn cho bài viết về "${topic}" (từ khóa: ${keyword}). ${description ? "Gợi ý nội dung: " + description : ""}` }
  ]);
}

// 🔖 Hashtag AI
async function generateHashtagsAI(keyword) {
  return await callOpenAI([
    { role: "system", content: "Bạn là chuyên gia mạng xã hội." },
    { role: "user", content: `Tạo 10 hashtag không dấu, dạng #tag, cho từ khóa "${keyword}".` }
  ]);
}

// Nút tạo mở bài AI
async function generateIntroFromAI() {
  const topic = document.getElementById('mainTopic').value;
  const keyword = document.getElementById('mainKeyword').value;
  const desc = document.getElementById('description').value;

  showStatus('info', '✍️ Đang tạo mở bài bằng AI...');
  const intro = await generateSEOBodyAI(topic, keyword, desc);
  document.getElementById('description').value = intro;
  showStatus('success', '✅ Đã tạo đoạn mở bài từ AI!');
}

// Nút gợi ý hashtag AI
async function suggestHashtagsFromAI() {
  const keyword = document.getElementById('mainKeyword').value;
  showStatus('info', '🔍 Đang gợi ý hashtag từ AI...');
  const hashtags = await generateHashtagsAI(keyword);
  document.getElementById('tags').value = hashtags.replace(/#/g, '').replace(/\s+/g, ', ');
  showStatus('success', '✅ Hashtag đã được cập nhật!');
}

// ✅ Gọi caption AI cho từng ảnh khi upload xong
async function displayUploadedImage(url) {
  const container = document.querySelector('.uploaded-images');
  const keyword = document.getElementById('mainKeyword').value || 'gái xinh';

  const captionText = await generateImageCaptionAI(url, keyword);

  const imageItem = document.createElement('div');
  imageItem.className = 'image-item';
  imageItem.innerHTML = `
    <img src="${url}" alt="Ảnh" class="image-preview">
    <input type="text" class="image-url" value="${url}" readonly onclick="this.select()">
    <p style="margin-top: 10px; font-style: italic; color: #666;">${captionText}</p>
    <button class="btn" style="background: #dc3545; margin-top: 10px;" onclick="removeImage('${url}')">
      🗑️ Xóa
    </button>
  `;
  container.appendChild(imageItem);
}
</script>

</body>
</html>
