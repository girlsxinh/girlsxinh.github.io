<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Upload ảnh và đăng Blogger</title>
  <style>
    /* Giữ nguyên CSS từ mã gốc */
    /* ... (copy toàn bộ phần style trong mã của bạn ở đây) ... */
  </style>
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
  <div class="dropzone"><div class="infoimg"></div></div>
  <div class="status"></div>
  <button id="copyAllLinksBtn">📋 Copy tất cả link ảnh</button>
  <br><br>
  <input type="text" id="keywords" placeholder="Nhập từ khóa SEO (vd: ảnh gái xinh Việt Nam, bikini...)" style="width: 80%;">
  <button id="generatePost">📝 Tạo bài viết Blogger</button>

  <script>
    const allLinks = [];
    const copyBtn = document.getElementById('copyAllLinksBtn');

    function updateCopyButton() {
      if (allLinks.length > 0) copyBtn.style.display = 'block';
    }

    function generateSeoContent(keywords) {
      const title = `Tổng hợp ${keywords} mới nhất cực chất`;
      const description = `Bộ sưu tập ${keywords.toLowerCase()} chất lượng cao với các chủ đề hot như gái xinh Việt, Nhật, bikini, áo dài và hơn thế nữa.`;
      const hashtags = keywords.toLowerCase().split(',').map(k => `#${k.trim().replace(/\s+/g, '')}`);
      return { title, description, hashtags };
    }

    function generatePostContent(imageLinks) {
      return imageLinks.map(link =>
        `<p><img src="${link}" alt="gái xinh" style="width:100%;max-width:800px;margin:10px auto;display:block;"/></p>`
      ).join('\n');
    }

    function createBloggerPost(title, content, labels) {
      const blogId = '4779196080303412305';
      const body = JSON.stringify({ title, content, labels });

      gapi.client.request({
        path: `/blogger/v3/blogs/${blogId}/posts/`,
        method: 'POST',
        body: body
      }).then(function(response) {
        alert('✅ Bài viết đã được đăng lên Blogger!');
        console.log(response);
      }, function(error) {
        alert('❌ Đăng bài thất bại');
        console.error(error);
      });
    }

    document.getElementById('generatePost').onclick = () => {
      const kw = document.getElementById('keywords').value.trim();
      if (!kw || allLinks.length === 0) {
        alert('⚠️ Nhập từ khóa và tải ít nhất một ảnh trước!');
        return;
      }
      const seo = generateSeoContent(kw);
      const content = `<p>${seo.description}</p>` + generatePostContent(allLinks);
      createBloggerPost(seo.title, content, seo.hashtags);
    };

    function initClient() {
      gapi.client.init({
        apiKey: 'AIzaSyDUMMY_REPLACE_WITH_REAL_KEY', // Cần thay bằng API Key nếu có
        clientId: '847908118054-dqsv7a47c8hajilv1e0k8e0gp5qdknlo.apps.googleusercontent.com',
        discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/blogger/v3/rest'],
        scope: 'https://www.googleapis.com/auth/blogger'
      }).then(() => gapi.auth2.getAuthInstance().signIn());
    }
    gapi.load('client:auth2', initClient);

    var feedback = function(res) {
      if (res.success === true) {
        const get_link = res.data.link.replace(/^http:\/\//i, 'https://');
        allLinks.push(get_link);
        document.querySelector('.status').classList.add('bg-success');
        document.querySelector('.status').innerHTML +=
          '<div class="linkimg"><input class="image-url" onclick="this.select()" value="' + get_link + '"/></div>' +
          '<div class="showimg"><img class="img" style="max-width:100%;margin-bottom:10px;" src="' + get_link + '"/></div>';
        updateCopyButton();
      }
    };

    new Imgur({
      clientid: '1460dad30d4be9a',
      callback: feedback
    });

    copyBtn.addEventListener('click', () => {
      const temp = document.createElement('textarea');
      temp.value = allLinks.join('\n');
      document.body.appendChild(temp);
      temp.select();
      document.execCommand('copy');
      document.body.removeChild(temp);
      alert("✅ Đã copy " + allLinks.length + " link ảnh!");
    });
  </script>
</body>
</html>
