<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tool tạo bài viết gái xinh Pro V2 - Đa chủ đề Enhanced</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --success-gradient: linear-gradient(135deg, #10b981, #059669);
      --danger-gradient: linear-gradient(135deg, #ef4444, #dc2626);
      --warning-gradient: linear-gradient(135deg, #f59e0b, #d97706);
      --info-gradient: linear-gradient(135deg, #3b82f6, #2563eb);
      --card-shadow: 0 10px 30px rgba(0,0,0,0.1);
      --hover-shadow: 0 20px 40px rgba(0,0,0,0.15);
      --border-radius: 15px;
      --transition: all 0.3s ease;
    }
    
    body { 
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; 
      background: var(--primary-gradient);
      min-height: 100vh; padding: 20px;
      font-size: 14px;
    }
    
    .container {
      max-width: 1400px; margin: 0 auto; 
      background: white; border-radius: 25px;
      box-shadow: var(--hover-shadow);
      overflow: hidden; position: relative;
    }
    
    .header {
      background: var(--primary-gradient);
      color: white; padding: 40px; text-align: center;
      position: relative; overflow: hidden;
    }
    
    .header::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100"><path d="M0,50 Q250,0 500,50 T1000,50 V100 H0 Z" fill="rgba(255,255,255,0.1)"/></svg>') bottom;
      background-size: cover;
    }
    
    .header-content { position: relative; z-index: 1; }
    .header h1 { font-size: 2.8em; margin-bottom: 15px; font-weight: 800; }
    .header p { opacity: 0.95; font-size: 1.2em; }
    
    .version-badge {
      position: absolute; top: 20px; right: 20px;
      background: rgba(255,255,255,0.2); color: white;
      padding: 8px 16px; border-radius: 20px; font-size: 12px;
      font-weight: 600; backdrop-filter: blur(10px);
    }
    
    .content { padding: 40px; }
    
    .stats-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 25px; margin-bottom: 40px;
    }
    
    .stat-card {
      background: var(--primary-gradient);
      color: white; padding: 30px; border-radius: 20px; text-align: center;
      transition: var(--transition); cursor: pointer;
      position: relative; overflow: hidden;
    }
    
    .stat-card::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(45deg, transparent 0%, rgba(255,255,255,0.1) 50%, transparent 100%);
      transform: translateX(-100%); transition: var(--transition);
    }
    
    .stat-card:hover::before { transform: translateX(100%); }
    .stat-card:hover { transform: translateY(-5px); box-shadow: var(--hover-shadow); }
    
    .stat-number { 
      font-size: 2.8em; font-weight: 900; margin-bottom: 10px;
      background: linear-gradient(45deg, #fff 0%, rgba(255,255,255,0.8) 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    
    .stat-label { opacity: 0.9; font-size: 1.1em; font-weight: 500; }
    
    /* NEW: Quick Actions Bar */
    .quick-actions {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px; margin: 30px 0; padding: 25px;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      border-radius: var(--border-radius); border: 2px solid #e2e8f0;
    }
    
    .quick-action {
      background: white; padding: 20px; border-radius: 12px;
      text-align: center; cursor: pointer; transition: var(--transition);
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }
    
    .quick-action:hover {
      transform: translateY(-3px); box-shadow: var(--card-shadow);
    }
    
    .quick-action .icon { font-size: 2em; margin-bottom: 10px; }
    .quick-action .title { font-weight: 600; color: #374151; }
    .quick-action .desc { font-size: 12px; color: #6b7280; margin-top: 5px; }
    
    /* Enhanced Form Styles */
    .form-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); 
      gap: 30px; 
    }
    
    .form-section {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      padding: 30px; border-radius: 20px;
      border: 2px solid #e2e8f0; transition: var(--transition);
      position: relative;
    }
    
    .form-section:hover {
      border-color: #cbd5e1; box-shadow: var(--card-shadow);
    }
    
    .section-title {
      font-size: 1.4em; color: #4c51bf; margin-bottom: 25px;
      display: flex; align-items: center; gap: 12px; font-weight: 700;
    }
    
    .form-group { margin-bottom: 25px; }
    
    label { 
      font-weight: 600; color: #374151; margin-bottom: 10px; 
      display: block; font-size: 1.05em;
    }
    
    input, select, textarea {
      width: 100%; padding: 15px 18px; border: 2px solid #e5e7eb;
      border-radius: 12px; font-size: 15px; transition: var(--transition);
      font-family: inherit;
    }
    
    input:focus, select:focus, textarea:focus {
      border-color: #667eea; outline: none;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
      transform: translateY(-1px);
    }
    
    textarea { 
      height: 140px; resize: vertical; font-family: 'JetBrains Mono', monospace;
      line-height: 1.6;
    }
    
    /* NEW: AI Templates Section */
    .ai-templates {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-radius: 20px; padding: 30px; margin: 30px 0;
      border: 2px solid #f59e0b;
    }
    
    .templates-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px; margin-top: 20px;
    }
    
    .template-card {
      background: white; padding: 20px; border-radius: 12px;
      cursor: pointer; transition: var(--transition);
      border: 2px solid transparent;
    }
    
    .template-card:hover {
      border-color: #f59e0b; transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(245, 158, 11, 0.15);
    }
    
    .template-card.active {
      border-color: #f59e0b; background: #fffbeb;
    }
    
    .template-title { font-weight: 600; color: #92400e; margin-bottom: 8px; }
    .template-desc { font-size: 13px; color: #a16207; }
    
    /* Enhanced Dropzone */
    .dropzone {
      border: 3px dashed #cbd5e1; border-radius: 20px; padding: 50px;
      text-align: center; cursor: pointer; transition: var(--transition);
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      position: relative; overflow: hidden;
    }
    
    .dropzone::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(45deg, transparent 0%, rgba(102, 126, 234, 0.05) 50%, transparent 100%);
      transform: translateX(-100%); transition: var(--transition);
    }
    
    .dropzone:hover::before, .dropzone.dragover::before { 
      transform: translateX(100%); 
    }
    
    .dropzone:hover, .dropzone.dragover {
      border-color: #667eea; background: #f0f4ff;
      transform: scale(1.02);
    }
    
    .dropzone-icon { 
      font-size: 4em; margin-bottom: 20px; 
      background: var(--primary-gradient);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    
    .image-preview { margin-top: 25px; text-align: center; }
    .image-preview img { 
      max-width: 100%; max-height: 350px; border-radius: 20px;
      box-shadow: var(--hover-shadow); transition: var(--transition);
    }
    
    .image-preview img:hover { transform: scale(1.05); }
    
    /* Enhanced Buttons */
    .btn {
      background: var(--primary-gradient);
      color: white; border: none; padding: 18px 35px;
      border-radius: 15px; font-weight: 700; font-size: 16px;
      cursor: pointer; transition: var(--transition); 
      width: 100%; margin: 12px 0; text-transform: uppercase;
      letter-spacing: 0.5px; position: relative; overflow: hidden;
    }
    
    .btn::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(45deg, transparent 0%, rgba(255,255,255,0.2) 50%, transparent 100%);
      transform: translateX(-100%); transition: var(--transition);
    }
    
    .btn:hover::before { transform: translateX(100%); }
    .btn:hover { 
      transform: translateY(-3px); 
      box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4); 
    }
    
    .btn:active { transform: translateY(-1px); }
    
    .btn-secondary { background: var(--success-gradient); }
    .btn-danger { background: var(--danger-gradient); }
    .btn-info { background: var(--info-gradient); }
    .btn-warning { background: var(--warning-gradient); }
    
    /* NEW: Progress Bar */
    .progress-container {
      background: #e5e7eb; border-radius: 10px; height: 8px;
      overflow: hidden; margin: 20px 0;
    }
    
    .progress-bar {
      background: var(--primary-gradient); height: 100%;
      border-radius: 10px; width: 0%; transition: width 0.3s ease;
    }
    
    /* Enhanced Toggle Switch */
    .toggle-switch {
      position: relative; display: inline-block; width: 70px; height: 35px;
      margin-left: 15px; vertical-align: middle;
    }
    
    .toggle-input { opacity: 0; width: 0; height: 0; }
    
    .toggle-slider {
      position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(135deg, #e5e7eb, #d1d5db);
      transition: .4s; border-radius: 35px; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .toggle-slider:before {
      position: absolute; content: ""; height: 27px; width: 27px;
      left: 4px; bottom: 4px; background: white;
      transition: .4s; border-radius: 50%; 
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    
    .toggle-input:checked + .toggle-slider { 
      background: var(--primary-gradient); 
    }
    
    .toggle-input:checked + .toggle-slider:before { 
      transform: translateX(35px); 
    }
    
    /* Enhanced Result Area */
    .result-area {
      background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
      border-radius: 20px; padding: 30px; margin-top: 40px;
      position: relative; overflow: hidden;
    }
    
    .result-area::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
      background: var(--primary-gradient);
    }
    
    .result-area label { 
      color: #e5e7eb; font-size: 1.2em; font-weight: 600; 
      margin-bottom: 15px; display: block;
    }
    
    .result-area textarea {
      background: linear-gradient(135deg, #111827 0%, #0f172a 100%);
      color: #e5e7eb; border: 2px solid #374151;
      font-family: 'JetBrains Mono', 'Courier New', monospace; 
      height: 450px; border-radius: 15px; padding: 20px;
      line-height: 1.6; font-size: 14px;
    }
    
    .result-area textarea:focus {
      border-color: #667eea; box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
    }
    
    /* NEW: Advanced Options Enhancement */
    .advanced-options {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-radius: 20px; padding: 30px; margin: 30px 0;
      border: 2px solid #f59e0b; position: relative;
    }
    
    .advanced-options::before {
      content: '⚡'; position: absolute; top: -10px; left: 30px;
      background: #f59e0b; color: white; padding: 8px;
      border-radius: 50%; font-size: 16px; width: 35px; height: 35px;
      display: flex; align-items: center; justify-content: center;
    }
    
    .advanced-title {
      color: #92400e; font-size: 1.3em; margin-bottom: 20px;
      display: flex; align-items: center; gap: 15px; font-weight: 700;
    }
    
    /* NEW: Loading Overlay Enhancement */
    .loading-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: linear-gradient(135deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.9) 100%);
      display: none; z-index: 10000; justify-content: center; align-items: center;
      backdrop-filter: blur(10px);
    }
    
    .loading-content {
      background: linear-gradient(135deg, white 0%, #f8fafc 100%);
      padding: 50px; border-radius: 25px; text-align: center; 
      max-width: 450px; box-shadow: var(--hover-shadow);
      border: 2px solid #e2e8f0;
    }
    
    .loading-spinner {
      width: 80px; height: 80px; border: 8px solid #f3f4f6;
      border-top: 8px solid #667eea; border-radius: 50%;
      animation: spin 1s linear infinite; margin: 0 auto 25px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loading-text {
      font-size: 1.3em; font-weight: 600; color: #374151;
      margin-bottom: 15px;
    }
    
    .loading-desc {
      color: #6b7280; margin-bottom: 20px; line-height: 1.6;
    }
    
    /* NEW: Success Message Enhancement */
    .success-message {
      background: var(--success-gradient);
      color: white; padding: 20px 25px; border-radius: 15px;
      margin: 20px 0; display: none; align-items: center; gap: 15px;
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
      animation: slideIn 0.5s ease;
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    /* NEW: Tips Section Enhancement */
    .tips-section {
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      border-radius: 20px; padding: 35px; margin: 40px 0;
      border: 2px solid #3b82f6; position: relative;
    }
    
    .tips-section::before {
      content: '💡'; position: absolute; top: -15px; left: 35px;
      background: #3b82f6; color: white; padding: 10px;
      border-radius: 50%; font-size: 18px; width: 40px; height: 40px;
      display: flex; align-items: center; justify-content: center;
    }
    
    .tips-title { 
      color: #1e40af; font-size: 1.4em; margin-bottom: 20px; 
      font-weight: 700; padding-left: 20px;
    }
    
    .tips-list { color: #1e3a8a; padding-left: 20px; }
    .tips-list li { 
      margin: 12px 0; line-height: 1.6; 
      position: relative; padding-left: 25px;
    }
    
    .tips-list li::before {
      content: '✨'; position: absolute; left: 0; top: 0;
      color: #3b82f6; font-weight: bold;
    }
    
    /* NEW: Character Counter Enhancement */
    .char-counter {
      font-size: 12px; color: #6b7280; float: right; margin-top: 5px;
      padding: 4px 8px; background: #f3f4f6; border-radius: 8px;
      font-weight: 500; transition: var(--transition);
    }
    
    .char-counter.warning { color: #d97706; background: #fef3c7; }
    .char-counter.danger { color: #dc2626; background: #fef2f2; }
    
    /* NEW: Preview Area Enhancement */
    .preview-area {
      background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
      border: 2px solid #e5e7eb; border-radius: 20px;
      padding: 40px; margin-top: 30px; display: none;
      box-shadow: var(--card-shadow);
    }
    
    .preview-title {
      color: #1f2937; font-size: 1.5em; margin-bottom: 25px;
      text-align: center; padding-bottom: 15px; 
      border-bottom: 3px solid #e5e7eb; font-weight: 700;
    }
    
    /* NEW: Action Buttons Grid */
    .actions-grid {
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
      gap: 20px; margin-top: 30px;
    }
    
    /* NEW: Floating Action Button */
    .fab {
      position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px;
      background: var(--primary-gradient); color: white; border: none;
      border-radius: 50%; font-size: 24px; cursor: pointer;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      transition: var(--transition); z-index: 1001;
    }
    
    .fab:hover {
      transform: scale(1.1); box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
    }
    
    /* NEW: Notification System */
    .notification {
      position: fixed; top: 30px; right: 30px; z-index: 10002;
      padding: 18px 25px; border-radius: 15px; color: white; 
      font-weight: 600; max-width: 350px; transform: translateX(400px);
      transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      box-shadow: var(--hover-shadow);
    }
    
    .notification.show { transform: translateX(0); }
    
    .notification.success { background: var(--success-gradient); }
    .notification.error { background: var(--danger-gradient); }
    .notification.info { background: var(--info-gradient); }
    .notification.warning { background: var(--warning-gradient); }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .form-grid, .actions-grid { grid-template-columns: 1fr; }
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .quick-actions { grid-template-columns: repeat(2, 1fr); }
      .templates-grid { grid-template-columns: 1fr; }
      .container { margin: 10px; border-radius: 20px; }
      .content { padding: 25px; }
      .header { padding: 30px; }
      .header h1 { font-size: 2.2em; }
      .fab { bottom: 20px; right: 20px; width: 55px; height: 55px; }
      .notification { top: 20px; right: 20px; max-width: 300px; }
    }
    
    @media (max-width: 480px) {
      .quick-actions { grid-template-columns: 1fr; }
      .stats-grid { grid-template-columns: 1fr; }
      .header h1 { font-size: 1.8em; }
      .content { padding: 20px; }
    }
  </style>
</head>
<body>

<div class="container">
  <!-- Enhanced Header -->
  <div class="header">
    <div class="version-badge">V2.0 ENHANCED</div>
    <div class="header-content">
      <h1>🎨 Tool Tạo Bài Viết Gái Xinh Pro V2</h1>
      <p>AI-Powered Content Generation • 30+ Templates • Advanced Analytics</p>
    </div>
  </div>

  <div class="content">
    <!-- Enhanced Stats Section -->
    <div class="stats-grid">
      <div class="stat-card" onclick="showStats('posts')">
        <div class="stat-number" id="totalPosts">0</div>
        <div class="stat-label">Bài viết đã tạo</div>
      </div>
      <div class="stat-card" onclick="showStats('images')">
        <div class="stat-number" id="totalImages">0</div>
        <div class="stat-label">Ảnh đã upload</div>
      </div>
      <div class="stat-card" onclick="showStats('templates')">
        <div class="stat-number">30+</div>
        <div class="stat-label">AI Templates</div>
      </div>
      <div class="stat-card" onclick="showStats('styles')">
        <div class="stat-number">8</div>
        <div class="stat-label">Phong cách viết</div>
      </div>
      <div class="stat-card" onclick="showStats('analytics')">
        <div class="stat-number" id="totalViews">0</div>
        <div class="stat-label">Total Views</div>
      </div>
      <div class="stat-card" onclick="showStats('success')">
        <div class="stat-number" id="successRate">98%</div>
        <div class="stat-label">Success Rate</div>
      </div>
    </div>

    <!-- NEW: Quick Actions Bar -->
    <div class="quick-actions">
      <div class="quick-action" onclick="quickGenerate('trending')">
        <div class="icon">🔥</div>
        <div class="title">Trending Now</div>
        <div class="desc">Tạo nội dung viral</div>
      </div>
      <div class="quick-action" onclick="quickGenerate('instagram')">
        <div class="icon">📷</div>
        <div class="title">Insta Ready</div>
        <div class="desc">Tối ưu cho Instagram</div>
      </div>
      <div class="quick-action" onclick="quickGenerate('tiktok')">
        <div class="icon">🎵</div>
        <div class="title">TikTok Viral</div>
        <div class="desc">Content cho TikTok</div>
      </div>
      <div class="quick-action" onclick="quickGenerate('professional')">
        <div class="icon">💼</div>
        <div class="title">Professional</div>
        <div class="desc">Nội dung chuyên nghiệp</div>
      </div>
    </div>

    <!-- NEW: AI Templates Section -->
    <div class="ai-templates">
      <div class="advanced-title">🤖 AI Content Templates</div>
      <div class="templates-grid" id="templatesGrid">
        <!-- Templates will be loaded here -->
      </div>
    </div>

    <!-- Enhanced Main Form -->
    <div class="form-grid">
      <!-- Enhanced Image Upload Section -->
      <div class="form-section">
        <div class="section-title">📸 Media Upload & Enhancement</div>
        
        <div class="form-group">
          <label>🖼️ Ảnh thumbnail (Auto-upload to Imgur):</label>
          <div class="dropzone" id="dropzone">
            <div class="dropzone-icon">📁</div>
            <div><strong>Kéo ảnh vào đây hoặc click để chọn</strong></div>
            <small>Hỗ trợ: JPG, PNG, GIF, WebP (tối đa 15MB) • AI Auto-enhance</small>
          </div>
          <div class="image-preview" id="imagePreview"></div>
          <input type="hidden" id="imgurLink" />
        </div>

        <div class="form-group">
          <label>🎬 Link video/media bổ sung:</label>
          <input type="url" id="videoLink" placeholder="https://example.com/video.mp4" />
          <small>Hỗ trợ: YouTube, TikTok, Instagram, Imgur, v.v.</small>
        </div>

        <div class="form-group">
          <label>🎨 Image Enhancement:</label>
          <div style="display: flex; gap: 15px; flex-wrap: wrap;">
            <label style="display: flex; align-items: center; gap: 10px; width: auto;">
              Auto Brightness
              <div class="toggle-switch">
                <input type="checkbox" id="autoBrightness" class="toggle-input" checked>
                <span class="toggle-slider"></span>
              </div>
            </label>
            <label style="display: flex; align-items: center; gap: 10px; width: auto;">
              AI Upscale
              <div class="toggle-switch">
                <input type="checkbox" id="aiUpscale" class="toggle-input">
                <span class="toggle-slider"></span>
              </div>
            </label>
          </div>
        </div>
      </div>

      <!-- Enhanced Content Settings -->
      <div class="form-section">
        <div class="section-title">✍️ Advanced Content Settings</div>
        
        <div class="form-group">
          <label>🧍‍♀️ Tên nhân vật chính:</label>
          <input type="text" id="characterName" placeholder="VD: Ngọc Trinh, Arisa, Lisa..." maxlength="100" />
          <div class="char-counter" id="nameCounter">0/100</div>
        </div>

        <div class="form-group">
          <label>🌏 Quốc gia/Vùng miền:</label>
          <select id="country">
            <option value="Việt Nam">🇻🇳 Việt Nam</option>
            <option value="Nhật Bản">🇯🇵 Nhật Bản</option>
            <option value="Hàn Quốc">🇰🇷 Hàn Quốc</option>
            <option value="Trung Quốc">🇨🇳 Trung Quốc</option>
            <option value="Thái Lan">🇹🇭 Thái Lan</option>
            <option value="Philippines">🇵🇭 Philippines</option>
            <option value="Indonesia">🇮🇩 Indonesia</option>
            <option value="Malaysia">🇲🇾 Malaysia</option>
            <option value="Singapore">🇸🇬 Singapore</option>
            <option value="Châu Âu">🇪🇺 Châu Âu</option>
            <option value="Mỹ">🇺🇸 Mỹ</option>
            <option value="Canada">🇨🇦 Canada</option>
            <option value="Đài Loan">🇹🇼 Đài Loan</option>
            <option value="Úc">🇦🇺 Úc</option>
          </select>
        </div>

        <div class="form-group">
          <label>📱 Platform chính:</label>
          <select id="platform">
            <option value="facebook">📘 Facebook</option>
            <option value="instagram">📷 Instagram</option>
            <option value="tiktok">🎵 TikTok</option>
            <option value="twitter">🐦 Twitter/X</option>
            <option value="youtube">📺 YouTube</option>
            <option value="linkedin">💼 LinkedIn</option>
            <option value="pinterest">📌 Pinterest</option>
            <option value="discord">🎮 Discord</option>
            <option value="reddit">🔴 Reddit</option>
            <option value="general">🌐 Multi-Platform</option>
          </select>
        </div>

        <div class="form-group">
          <label>🎯 Target Audience:</label>
          <select id="audience">
            <option value="general">🌐 General (18+)</option>
            <option value="young-adults">👨‍🎓 Young Adults (18-25)</option>
            <option value="millennials">👩‍💼 Millennials (26-40)</option>
            <option value="gen-x">👨‍👩‍👧‍👦 Gen X (41-55)</option>
            <option value="photography">📸 Photography Enthusiasts</option>
            <option value="fashion">👗 Fashion Lovers</option>
            <option value="gamers">🎮 Gaming Community</option>
            <option value="artists">🎨 Art Community</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Enhanced Topic Selection -->
    <div class="form-section" style="margin-top: 30px;">
      <div class="section-title">🎯 Advanced Topic & Style Selection</div>
      
      <div class="form-grid">
        <div class="form-group">
          <label>📂 Chủ đề chính:</label>
          <select id="topic" style="font-size: 16px; padding: 15px;">
            <optgroup label="📱 Social Media Focused">
              <option value="facebook-girl">📘 Facebook Beauty</option>
              <option value="instagram-girl">📷 Instagram Model</option>
              <option value="tiktok-girl">🎵 TikTok Star</option>
              <option value="twitter-girl">🐦 Twitter Personality</option>
              <option value="youtube-girl">📺 YouTube Creator</option>
              <option value="linkedin-girl">💼 Professional Model</option>
            </optgroup>
            <optgroup label="🌍 Regional Beauties">
              <option value="vn-girl">🇻🇳 Vietnamese Beauty</option>
              <option value="japan-girl">🇯🇵 Japanese Kawaii</option>
              <option value="korea-girl">🇰🇷 Korean Style</option>
              <option value="china-girl">🇨🇳 Chinese Elegance</option>
              <option value="thai-girl">🇹🇭 Thai Beauty</option>
              <option value="europe-girl">🇪🇺 European Style</option>
              <option value="america-girl">🇺🇸 American Beauty</option>
            </optgroup>
            <optgroup label="🎨 Style Categories">
              <option value="short-hair">💇‍♀️ Short Hair Style</option>
              <option value="long-hair">💇‍♀️ Long Hair Beauty</option>
              <option value="cute-girl">🥰 Cute Aesthetic</option>
              <option value="elegant-girl">👑 Elegant Style</option>
              <option value="sporty-girl">🏃‍♀️ Athletic Beauty</option>
              <option value="artsy-girl">🎨 Artistic Vibe</option>
              <option value="minimalist-girl">⚪ Minimalist Style</option>
            </optgroup>
            <optgroup label="👗 Fashion & Outfits">
              <option value="bikini">👙 Swimwear Collection</option>
              <option value="ao-dai">🌺 Traditional Áo Dài</option>
              <option value="school">🎒 School Uniform</option>
              <option value="casual">👕 Casual Wear</option>
              <option value="formal">👗 Formal Attire</option>
              <option value="street-fashion">🛣️ Street Style</option>
              <option value="vintage">📻 Vintage Fashion</option>
              <option value="futuristic">🚀 Future Fashion</option>
            </optgroup>
            <optgroup label="💼 Profession & Roles">
              <option value="hotgirl">🔥 Influencer</option>
              <option value="model">📸 Professional Model</option>
              <option value="idol">⭐ Entertainment Idol</option>
              <option value="actress">🎬 Actress/Performer</option>
              <option value="streamer">🎮 Content Streamer</option>
              <option value="dancer">💃 Professional Dancer</option>
              <option value="singer">🎤 Vocalist/Artist</option>
            </optgroup>
            <optgroup label="🎭 Special Concepts">
              <option value="cosplay">🎭 Cosplay Character</option>
              <option value="wallpaper">🖼️ Wallpaper Collection</option>
              <option value="photography">📷 Photography Art</option>
              <option value="lifestyle">🌅 Lifestyle Content</option>
              <option value="travel">✈️ Travel Beauty</option>
              <option value="fitness">💪 Fitness Model</option>
            </optgroup>
          </select>
        </div>

        <div class="form-group">
          <label>✍️ Writing Style:</label>
          <select id="style">
            <option value="goi-cam">🔥 Seductive & Alluring</option>
            <option value="nhe-nhang">🌸 Gentle & Sweet</option>
            <option value="cuon-hut">✨ Mysterious & Captivating</option>
            <option value="trong-sang">🌟 Pure & Innocent</option>
            <option value="ca-tinh">😎 Bold & Confident</option>
            <option value="dang-yeu">🥰 Cute & Adorable</option>
            <option value="thanh-lich">👑 Elegant & Classy</option>
            <option value="tu-nhien">🍃 Natural & Authentic</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label>📏 Content Length & Detail:</label>
        <select id="length">
          <option value="micro">⚡ Micro (50-100 từ) - Social Media</option>
          <option value="short">📝 Short (100-200 từ) - Quick Read</option>
          <option value="medium">📄 Medium (200-400 từ) - Detailed</option>
          <option value="long">📰 Long (400-600 từ) - In-depth</option>
          <option value="article">📚 Article (600+ từ) - Full Story</option>
        </select>
      </div>
    </div>

    <!-- Enhanced Advanced Options -->
    <div class="advanced-options">
      <div class="advanced-title">⚙️ Advanced AI Configuration</div>
      
      <div class="form-grid">
        <div class="form-group">
          <label>🏷️ Custom Tags & Keywords:</label>
          <input type="text" id="customTags" placeholder="hotgirl, beauty, fashion, trending, viral..." maxlength="300" />
          <div class="char-counter" id="tagsCounter">0/300</div>
        </div>

        <div class="form-group">
          <label>🎨 Content Tone:</label>
          <select id="tone">
            <option value="professional">💼 Professional</option>
            <option value="casual">😊 Casual & Friendly</option>
            <option value="playful">🎉 Playful & Fun</option>
            <option value="romantic">💕 Romantic & Dreamy</option>
            <option value="edgy">⚡ Edgy & Bold</option>
            <option value="artistic">🎨 Artistic & Creative</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label>🌍 Language & Localization:</label>
        <select id="language">
          <option value="vi">🇻🇳 Tiếng Việt</option>
          <option value="en">🇺🇸 English</option>
          <option value="ja">🇯🇵 日本語</option>
          <option value="ko">🇰🇷 한국어</option>
          <option value="zh">🇨🇳 中文</option>
          <option value="th">🇹🇭 ภาษาไทย</option>
        </select>
      </div>

      <!-- Enhanced Toggle Options -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-top: 25px;">
        <label style="display: flex; align-items: center; gap: 10px;">
          🎬 Include Video Autoplay
          <div class="toggle-switch">
            <input type="checkbox" id="includeVideo" class="toggle-input" checked>
            <span class="toggle-slider"></span>
          </div>
        </label>

        <label style="display: flex; align-items: center; gap: 10px;">
          📊 Advanced SEO Meta
          <div class="toggle-switch">
            <input type="checkbox" id="includeSEO" class="toggle-input" checked>
            <span class="toggle-slider"></span>
          </div>
        </label>

        <label style="display: flex; align-items: center; gap: 10px;">
          🔗 Related Content Links
          <div class="toggle-switch">
            <input type="checkbox" id="includeRelated" class="toggle-input" checked>
            <span class="toggle-slider"></span>
          </div>
        </label>

        <label style="display: flex; align-items: center; gap: 10px;">
          📢 Social Sharing Buttons
          <div class="toggle-switch">
            <input type="checkbox" id="includeSocial" class="toggle-input" checked>
            <span class="toggle-slider"></span>
          </div>
        </label>

        <label style="display: flex; align-items: center; gap: 10px;">
          🤖 AI Content Analysis
          <div class="toggle-switch">
            <input type="checkbox" id="includeAnalysis" class="toggle-input">
            <span class="toggle-slider"></span>
          </div>
        </label>

        <label style="display: flex; align-items: center; gap: 10px;">
          📱 Mobile Optimization
          <div class="toggle-switch">
            <input type="checkbox" id="mobileOptimized" class="toggle-input" checked>
            <span class="toggle-slider"></span>
          </div>
        </label>
      </div>

      <!-- NEW: AI Creativity Slider -->
      <div class="form-group" style="margin-top: 25px;">
        <label>🎨 AI Creativity Level:</label>
        <div style="display: flex; align-items: center; gap: 15px;">
          <span style="font-size: 12px; color: #6b7280;">Conservative</span>
          <input type="range" id="creativityLevel" min="1" max="10" value="7" 
                 style="flex: 1; height: 8px; border-radius: 5px; background: #e5e7eb; outline: none;" />
          <span style="font-size: 12px; color: #6b7280;">Creative</span>
          <div id="creativityValue" style="min-width: 30px; font-weight: 600; color: #667eea;">7</div>
        </div>
      </div>
    </div>

    <!-- Enhanced Generate Button with Progress -->
    <div style="text-align: center; margin: 40px 0;">
      <button class="btn" onclick="generateArticle()" style="font-size: 20px; padding: 25px 50px; max-width: 400px;">
        🚀 Generate AI Content
      </button>
      <div class="progress-container" id="progressContainer" style="display: none; max-width: 400px; margin: 20px auto 0;">
        <div class="progress-bar" id="progressBar"></div>
      </div>
    </div>

    <!-- Enhanced Success Message -->
    <div class="success-message" id="successMessage">
      ✅ Content generated successfully! Ready for publication.
    </div>

    <!-- Enhanced Result Section -->
    <div class="result-area">
      <label>📋 Generated HTML Content (Production Ready):</label>
      <textarea id="resultHTML" readonly placeholder="Your AI-generated content will appear here after clicking 'Generate AI Content'...

✨ Enhanced features in V2:
• Advanced AI templates
• Multi-language support  
• Mobile optimization
• SEO analysis
• Social media integration
• Content analytics

Ready to create amazing content? Fill in the details above and hit generate!"></textarea>
    </div>

    <!-- Enhanced Action Buttons -->
    <div class="actions-grid">
      <button class="btn btn-secondary" onclick="copyResult()">📄 Copy HTML Code</button>
      <button class="btn btn-info" onclick="previewContent()">👁️ Live Preview</button>
      <button class="btn btn-danger" onclick="downloadHTML()">💾 Download HTML</button>
      <button class="btn btn-warning" onclick="exportToWordPress()">📝 Export to WordPress</button>
      <button class="btn" onclick="shareToSocial()">📢 Share to Social</button>
      <button class="btn btn-info" onclick="analyzeContent()">📊 Content Analytics</button>
    </div>

    <!-- Enhanced Preview Area -->
    <div id="previewArea" class="preview-area">
      <div class="preview-title">👁️ Live Content Preview</div>
      <div id="previewContent"></div>
    </div>

    <!-- Enhanced Tips Section -->
    <div class="tips-section">
      <div class="tips-title">💡 Pro Tips for Maximum Engagement</div>
      <ul class="tips-list">
        <li><strong>SEO Optimization:</strong> Use specific character names and trending keywords for better search visibility</li>
        <li><strong>Platform Specific:</strong> Tailor content length and style to match your target platform's algorithm</li>
        <li><strong>Visual Quality:</strong> High-resolution images (1080p+) significantly increase engagement rates</li>
        <li><strong>Timing Strategy:</strong> Post during peak hours for your target audience's timezone</li>
        <li><strong>Hashtag Research:</strong> Mix trending hashtags with niche-specific tags for optimal reach</li>
        <li><strong>Content Variety:</strong> Alternate between different styles and topics to maintain audience interest</li>
        <li><strong>Analytics Tracking:</strong> Monitor performance metrics to refine your content strategy</li>
      </ul>
    </div>
  </div>
</div>

<!-- Enhanced Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-content">
    <div class="loading-spinner"></div>
    <h3 class="loading-text">🤖 AI Processing Content...</h3>
    <p class="loading-desc">Advanced algorithms are analyzing and generating your content</p>
    <div class="progress-container">
      <div class="progress-bar" id="loadingProgress"></div>
    </div>
    <div id="loadingStage" style="margin-top: 15px; color: #667eea; font-weight: 600;"></div>
  </div>
</div>

<!-- NEW: Floating Action Button -->
<button class="fab" onclick="scrollToTop()" title="Scroll to Top">⬆️</button>

<script>
// Enhanced Configuration
const CONFIG = {
  IMGUR_CLIENT_ID: '3a8be4390ef3eb8',
  AI_TEMPLATES: [],
  STORAGE_KEY: 'contentGeneratorV2',
  VERSION: '2.0'
};

// Enhanced State Management
let appState = {
  totalPosts: parseInt(localStorage.getItem('totalPosts') || '0'),
  totalImages: parseInt(localStorage.getItem('totalImages') || '0'),
  totalViews: parseInt(localStorage.getItem('totalViews') || '0'),
  successRate: localStorage.getItem('successRate') || '98%',
  currentTemplate: null,
  isGenerating: false,
  version: CONFIG.VERSION
};

// Enhanced Initialization
document.addEventListener('DOMContentLoaded', function() {
  initializeApp();
  loadAITemplates();
  setupEnhancedEventListeners();
  updateStats();
  loadSavedData();
  setupCharacterCounters();
  initializeSliders();
});

// Initialize Enhanced App
function initializeApp() {
  console.log('🚀 Content Generator V2 Initialized');
  
  // Check for saved theme
  const savedTheme = localStorage.getItem('theme') || 'light';
  document.body.setAttribute('data-theme', savedTheme);
  
  // Initialize tooltips and help system
  initializeHelp();
  
  // Check for updates
  checkForUpdates();
}

// Load AI Templates
function loadAITemplates() {
  const templates = [
    {
      id: 'viral-tiktok',
      title: 'Viral TikTok Style',
      description: 'Optimized for TikTok algorithm with trending elements',
      category: 'social',
      popularity: 95
    },
    {
      id: 'instagram-aesthetic',
      title: 'Instagram Aesthetic',
      description: 'Perfect for Instagram feed with high engagement potential',
      category: 'visual',
      popularity: 92
    },
    {
      id: 'professional-portfolio',
      title: 'Professional Portfolio',
      description: 'Clean, professional style for business use',
      category: 'business',
      popularity: 88
    },
    {
      id: 'kawaii-japanese',
      title: 'Kawaii Japanese',
      description: 'Cute Japanese aesthetic with anime influence',
      category: 'culture',
      popularity: 90
    },
    {
      id: 'korean-idol',
      title: 'Korean Idol Style',
      description: 'K-pop inspired content with trendy elements',
      category: 'kpop',
      popularity: 94
    },
    {
      id: 'minimalist-elegant',
      title: 'Minimalist Elegant',
      description: 'Clean, sophisticated approach with subtle beauty',
      category: 'minimal',
      popularity: 86
    }
  ];

  const templatesGrid = document.getElementById('templatesGrid');
  templatesGrid.innerHTML = templates.map(template => `
    <div class="template-card" onclick="selectTemplate('${template.id}')" data-template="${template.id}">
      <div class="template-title">${template.title}</div>
      <div class="template-desc">${template.description}</div>
      <div style="margin-top: 10px; display: flex; justify-content: space-between; align-items: center;">
        <span style="font-size: 11px; color: #92400e; background: #fef3c7; padding: 2px 8px; border-radius: 10px;">${template.category}</span>
        <span style="font-size: 11px; color: #059669;">🔥 ${template.popularity}%</span>
      </div>
    </div>
  `).join('');

  CONFIG.AI_TEMPLATES = templates;
}

// Enhanced Event Listeners
function setupEnhancedEventListeners() {
  // Enhanced drag & drop
  const dropzone = document.getElementById('dropzone');
  
  ['dragover', 'dragenter'].forEach(event => {
    dropzone.addEventListener(event, e => {
      e.preventDefault();
      dropzone.classList.add('dragover');
    });
  });

  ['dragleave', 'dragend'].forEach(event => {
    dropzone.addEventListener(event, () => {
      dropzone.classList.remove('dragover');
    });
  });

  dropzone.addEventListener('drop', e => {
    e.preventDefault();
    dropzone.classList.remove('dragover');
    if(e.dataTransfer.files.length) handleFileUpload(e.dataTransfer.files[0]);
  });

  dropzone.addEventListener('click', () => {
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = 'image/*';
    fileInput.multiple = false;
    fileInput.onchange = () => {
      if(fileInput.files.length) handleFileUpload(fileInput.files[0]);
    };
    fileInput.click();
  });

  // Enhanced auto-save
  ['input', 'change'].forEach(event => {
    document.addEventListener(event, debounce(autoSave, 1000));
  });

  // Enhanced keyboard shortcuts
  document.addEventListener('keydown', handleEnhancedShortcuts);

  // Window scroll events
  window.addEventListener('scroll', handleScroll);
}

// Enhanced File Upload Handler
async function handleFileUpload(file) {
  if(!validateFile(file)) return;
  
  showLoading(true, 'Uploading and processing image...');
  updateProgress(0);

  try {
    // Simulate processing steps
    const steps = [
      { message: 'Validating image...', progress: 10 },
      { message: 'Optimizing quality...', progress: 30 },
      { message: 'Uploading to Imgur...', progress: 60 },
      { message: 'Generating metadata...', progress: 80 },
      { message: 'Finalizing...', progress: 100 }
    ];

    for (const step of steps) {
      document.getElementById('loadingStage').textContent = step.message;
      updateProgress(step.progress);
      await sleep(500 + Math.random() * 300);
    }

    const formData = new FormData();
    formData.append('image', file);

    const response = await fetch('https://api.imgur.com/3/image', {
      method: 'POST',
      headers: { Authorization: `Client-ID ${CONFIG.IMGUR_CLIENT_ID}` },
      body: formData
    });

    const data = await response.json();
    
    if(data.success) {
      const link = data.data.link;
      document.getElementById('imgurLink').value = link;
      document.getElementById('imagePreview').innerHTML = 
        `<img src="${link}" alt="Uploaded image" style="max-width: 100%; border-radius: 20px; box-shadow: var(--hover-shadow);">`;
      
      incrementStats('totalImages');
      showNotification('✅ Image uploaded and processed successfully!', 'success');
      
      // Auto-enhance if enabled
      if (document.getElementById('autoBrightness').checked) {
        await enhanceImage(link);
      }
    } else {
      throw new Error('Upload failed');
    }
  } catch (error) {
    console.error('Upload error:', error);
    showNotification('❌ Upload failed. Please try again.', 'error');
  } finally {
    showLoading(false);
  }
}

// File Validation
function validateFile(file) {
  const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
  const maxSize = 15 * 1024 * 1024; // 15MB

  if (!validTypes.includes(file.type)) {
    showNotification('⚠️ Please select a valid image file (JPG, PNG, GIF, WebP)', 'warning');
    return false;
  }
  
  if (file.size > maxSize) {
    showNotification('⚠️ File too large! Please select an image under 15MB', 'warning');
    return false;
  }
  
  return true;
}

// Enhanced Image Enhancement (Placeholder)
async function enhanceImage(imageUrl) {
  // This would integrate with an AI image enhancement API
  showNotification('🎨 AI image enhancement completed!', 'info');
}

// Initialize Sliders
function initializeSliders() {
  const creativitySlider = document.getElementById('creativityLevel');
  const creativityValue = document.getElementById('creativityValue');
  
  creativitySlider.addEventListener('input', function() {
    creativityValue.textContent = this.value;
    creativityValue.style.color = this.value > 7 ? '#f59e0b' : '#667eea';
  });
}

// Enhanced Character Counters
function setupCharacterCounters() {
  const counters = [
    { id: 'characterName', counter: 'nameCounter', max: 100 },
    { id: 'customTags', counter: 'tagsCounter', max: 300 }
  ];

  counters.forEach(({ id, counter, max }) => {
    const input = document.getElementById(id);
    const counterEl = document.getElementById(counter);
    
    input?.addEventListener('input', () => {
      const length = input.value.length;
      const percentage = (length / max) * 100;
      
      counterEl.textContent = `${length}/${max}`;
      
      if (percentage > 90) {
        counterEl.className = 'char-counter danger';
      } else if (percentage > 75) {
        counterEl.className = 'char-counter warning';
      } else {
        counterEl.className = 'char-counter';
      }
    });
  });
}

// Template Selection
function selectTemplate(templateId) {
  // Remove active class from all templates
  document.querySelectorAll('.template-card').forEach(card => {
    card.classList.remove('active');
  });
  
  // Add active class to selected template
  const selectedCard = document.querySelector(`[data-template="${templateId}"]`);
  selectedCard.classList.add('active');
  
  appState.currentTemplate = templateId;
  
  // Apply template settings
  applyTemplate(templateId);
  
  showNotification(`🎨 Template "${CONFIG.AI_TEMPLATES.find(t => t.id === templateId).title}" selected!`, 'info');
}

// Apply Template Settings
function applyTemplate(templateId) {
  const template = CONFIG.AI_TEMPLATES.find(t => t.id === templateId);
  if (!template) return;

  // Apply template-specific settings based on template type
  const settings = {
    'viral-tiktok': {
      platform: 'tiktok',
      style: 'ca-tinh',
      length: 'short',
      tone: 'playful'
    },
    'instagram-aesthetic': {
      platform: 'instagram',
      style: 'thanh-lich',
      length: 'medium',
      tone: 'artistic'
    },
    'professional-portfolio': {
      platform: 'linkedin',
      style: 'thanh-lich',
      length: 'long',
      tone: 'professional'
    },
    'kawaii-japanese': {
      country: 'Nhật Bản',
      style: 'dang-yeu',
      length: 'medium',
      tone: 'playful'
    },
    'korean-idol': {
      country: 'Hàn Quốc',
      style: 'ca-tinh',
      length: 'medium',
      tone: 'edgy'
    },
    'minimalist-elegant': {
      style: 'thanh-lich',
      length: 'long',
      tone: 'artistic'
    }
  };

  const config = settings[templateId];
  if (config) {
    Object.keys(config).forEach(key => {
      const element = document.getElementById(key);
      if (element) {
        element.value = config[key];
      }
    });
  }
}

// Quick Generate Functions
function quickGenerate(type) {
  const quickSettings = {
    'trending': {
      topic: 'tiktok-girl',
      style: 'ca-tinh',
      platform: 'tiktok',
      length: 'short',
      tone: 'playful'
    },
    'instagram': {
      topic: 'instagram-girl',
      style: 'thanh-lich',
      platform: 'instagram',
      length: 'medium',
      tone: 'artistic'
    },
    'tiktok': {
      topic: 'tiktok-girl',
      style: 'dang-yeu',
      platform: 'tiktok',
      length: 'short',
      tone: 'playful'
    },
    'professional': {
      topic: 'model',
      style: 'thanh-lich',
      platform: 'linkedin',
      length: 'long',
      tone: 'professional'
    }
  };

  const settings = quickSettings[type];
  if (settings) {
    Object.keys(settings).forEach(key => {
      const element = document.getElementById(key);
      if (element) element.value = settings[key];
    });
    
    showNotification(`Quick setup applied for ${type} content!`, 'success');
    autoSave();
  }
}

// Enhanced Main Content Generation
async function generateArticle() {
  if (appState.isGenerating) {
    showNotification('Generation already in progress...', 'warning');
    return;
  }

  const formData = getEnhancedFormData();
  
  if (!validateFormData(formData)) return;

  appState.isGenerating = true;
  showLoading(true, 'AI is analyzing and generating content...');
  updateProgress(0);
  
  try {
    // Enhanced AI processing simulation
    const stages = [
      { message: 'Analyzing image content...', progress: 15 },
      { message: 'Processing character details...', progress: 25 },
      { message: 'Generating SEO optimized title...', progress: 40 },
      { message: 'Creating engaging content body...', progress: 55 },
      { message: 'Optimizing for target platform...', progress: 70 },
      { message: 'Adding social media elements...', progress: 85 },
      { message: 'Finalizing and formatting...', progress: 95 },
      { message: 'Quality check complete!', progress: 100 }
    ];

    for (const stage of stages) {
      document.getElementById('loadingStage').textContent = stage.message;
      updateProgress(stage.progress);
      await sleep(800 + Math.random() * 400);
    }

    const content = await generateEnhancedContent(formData);
    document.getElementById('resultHTML').value = content;
    
    incrementStats('totalPosts');
    updateSuccessRate();
    showSuccessMessage();
    scrollToResult();
    
    // Analytics tracking
    trackContentGeneration(formData);
    
  } catch (error) {
    console.error('Generation error:', error);
    showNotification('Content generation failed. Please try again.', 'error');
  } finally {
    appState.isGenerating = false;
    showLoading(false);
  }
}

// Get Enhanced Form Data
function getEnhancedFormData() {
  return {
    imgurLink: document.getElementById('imgurLink').value.trim(),
    videoLink: document.getElementById('videoLink').value.trim(),
    characterName: document.getElementById('characterName').value.trim(),
    country: document.getElementById('country').value,
    platform: document.getElementById('platform').value,
    audience: document.getElementById('audience').value,
    topic: document.getElementById('topic').value,
    style: document.getElementById('style').value,
    length: document.getElementById('length').value,
    tone: document.getElementById('tone').value,
    language: document.getElementById('language').value,
    customTags: document.getElementById('customTags').value.trim(),
    creativityLevel: parseInt(document.getElementById('creativityLevel').value),
    
    // Enhanced options
    includeVideo: document.getElementById('includeVideo').checked,
    includeSEO: document.getElementById('includeSEO').checked,
    includeRelated: document.getElementById('includeRelated').checked,
    includeSocial: document.getElementById('includeSocial').checked,
    includeAnalysis: document.getElementById('includeAnalysis').checked,
    mobileOptimized: document.getElementById('mobileOptimized').checked,
    autoBrightness: document.getElementById('autoBrightness').checked,
    aiUpscale: document.getElementById('aiUpscale').checked,
    
    // Template and metadata
    selectedTemplate: appState.currentTemplate,
    timestamp: Date.now(),
    version: CONFIG.VERSION
  };
}

// Enhanced Form Validation
function validateFormData(formData) {
  if (!formData.imgurLink.trim()) {
    showNotification('Please upload an image thumbnail first!', 'error');
    return false;
  }

  if (!formData.characterName.trim() && formData.length !== 'micro') {
    const confirmation = confirm('No character name specified. This may result in generic content. Continue anyway?');
    if (!confirmation) return false;
  }

  return true;
}

// Enhanced Content Generation Engine
async function generateEnhancedContent(formData) {
  const subject = formData.characterName || getDefaultSubject(formData.topic, formData.country);
  const title = generateEnhancedTitle(subject, formData);
  const description = generateEnhancedDescription(subject, formData);
  const tags = generateSmartTags(formData);
  const content = generateAdvancedContentBody(subject, formData);
  
  return buildEnhancedHTML(title, description, formData.imgurLink, formData.videoLink, content, tags, formData);
}

// Enhanced Title Generation
function generateEnhancedTitle(subject, formData) {
  const { topic, platform, country, creativityLevel, selectedTemplate } = formData;
  
  // Template-specific titles
  if (selectedTemplate) {
    const template = CONFIG.AI_TEMPLATES.find(t => t.id === selectedTemplate);
    if (template) {
      return generateTemplateTitle(subject, template, formData);
    }
  }

  // Platform-optimized titles
  const platformTitles = {
    'tiktok': [
      `🎵 ${subject} - Viral TikTok Content That's Breaking The Internet`,
      `🔥 ${subject}: TikTok Star With 10M+ Views Per Video`,
      `⚡ ${subject} - The TikTok Sensation Everyone's Talking About`,
    ],
    'instagram': [
      `📸 ${subject} - Instagram Model With Perfect Aesthetic Feed`,
      `✨ ${subject}: IG Beauty That's Redefining Standards`,
      `🌟 ${subject} - Instagram Icon With Million+ Engagement`,
    ],
    'facebook': [
      `📘 ${subject} - Facebook's Most Talked About Beauty`,
      `💎 ${subject}: The Facebook Star Everyone Follows`,
    ],
    'youtube': [
      `📺 ${subject} - YouTube Creator Making Waves`,
      `🎬 ${subject}: Content Creator With Viral Videos`,
    ]
  };

  const titles = platformTitles[platform] || [
    `✨ ${subject} - Premium Beauty Content Collection`,
    `🌟 ${subject}: High-Quality Gallery ${country}`,
    `💎 ${subject} - Exclusive Content You Can't Miss`
  ];

  // Creativity level adjustment
  if (creativityLevel >= 8) {
    return enhanceCreativeTitle(pick(titles), creativityLevel);
  }

  return pick(titles);
}

// Creative Title Enhancement
function enhanceCreativeTitle(baseTitle, creativityLevel) {
  const enhancements = [
    'Mind-Blowing', 'Jaw-Dropping', 'Absolutely Stunning', 'Incredibly Gorgeous',
    'Breathtakingly Beautiful', 'Phenomenally Attractive', 'Exceptionally Radiant'
  ];
  
  if (creativityLevel >= 9) {
    const enhancement = pick(enhancements);
    return baseTitle.replace(' - ', ` - ${enhancement} `);
  }
  
  return baseTitle;
}

// Advanced Content Body Generation
function generateAdvancedContentBody(subject, formData) {
  const { style, length, tone, creativityLevel, language, audience } = formData;
  
  // Language-specific content
  if (language !== 'vi') {
    return generateMultiLanguageContent(subject, formData);
  }

  // Audience-specific adjustments
  const audienceStyles = {
    'young-adults': 'Gen Z vibes với energy không thể cưỡng lại',
    'millennials': 'Phong cách millennial đầy tinh tế và trưởng thành',
    'photography': 'Nghệ thuật nhiếp ảnh đỉnh cao với composition hoàn hảo',
    'fashion': 'Fashion statement độc đáo và trendsetting',
    'gamers': 'Gaming aesthetic với màu sắc và style độc đáo'
  };

  const baseContent = generateStyleBasedContent(subject, style, length, formData);
  
  // Add audience-specific elements
  if (audienceStyles[audience]) {
    baseContent.content += `<p>Đặc biệt dành cho cộng đồng ${audience}: ${audienceStyles[audience]}, ${subject} thực sự là biểu tượng hoàn hảo cho phong cách sống hiện đại.</p>`;
  }

  return baseContent.content;
}

// Multi-language Content Generation
function generateMultiLanguageContent(subject, formData) {
  const { language, style, platform } = formData;
  
  const langContent = {
    'en': {
      intro: `✨ ${subject} is absolutely stunning and captivating, bringing incredible beauty and charm that's impossible to ignore.`,
      body: `With perfect features and an amazing personality, ${subject} represents the epitome of beauty and elegance. Every photo tells a story of grace, confidence, and natural allure.`,
      outro: `This collection showcases the very best of ${subject}, perfect for ${platform} and guaranteed to get amazing engagement.`
    },
    'ja': {
      intro: `✨ ${subject}は本当に美しく、魅力的な存在です。その美しさは多くの人々を魅了し続けています。`,
      body: `完璧な美貌と素晴らしい個性を持つ${subject}は、美しさと優雅さの象徴です。すべての写真が物語を語り、上品さと自信、そして自然な魅力を表現しています。`,
      outro: `このコレクションは${subject}の最高の魅力を紹介し、${platform}に最適で、素晴らしいエンゲージメントを保証します。`
    },
    'ko': {
      intro: `✨ ${subject}는 정말 아름답고 매력적이며, 무시할 수 없는 놀라운 아름다움과 매력을 선사합니다.`,
      body: `완벽한 외모와 놀라운 개성을 가진 ${subject}는 아름다움과 우아함의 전형을 나타냅니다. 모든 사진은 우아함, 자신감, 자연스러운 매력의 이야기를 전합니다.`,
      outro: `이 컬렉션은 ${subject}의 최고의 모습을 보여주며, ${platform}에 완벽하고 놀라운 참여를 보장합니다.`
    }
  };

  const content = langContent[language] || langContent['en'];
  return `<p>${content.intro}</p><p>${content.body}</p><p>${content.outro}</p>`;
}

// Enhanced Smart Tags Generation
function generateSmartTags(formData) {
  const { topic, platform, country, customTags, audience, selectedTemplate } = formData;
  
  let baseTags = ['beauty', 'gorgeous', 'stunning', country.toLowerCase()];
  
  // Platform-specific tags
  const platformTags = {
    'tiktok': ['viral', 'fyp', 'trending', 'tiktok famous'],
    'instagram': ['insta model', 'aesthetic', 'photography', 'ig beauty'],
    'facebook': ['facebook star', 'social media', 'viral content'],
    'youtube': ['youtube creator', 'content creator', 'subscriber favorite']
  };

  // Topic-specific tags
  const topicTags = {
    'cosplay': ['cosplay', 'anime', 'character', 'costume'],
    'bikini': ['swimwear', 'beach', 'summer', 'body goals'],
    'fashion': ['style', 'outfit', 'trendy', 'fashionable']
  };

  // Audience-specific tags
  const audienceTags = {
    'young-adults': ['gen z', 'youth', 'trendy'],
    'photography': ['photogenic', 'camera ready', 'professional'],
    'fashion': ['style icon', 'fashionista', 'trendsetter']
  };

  // Template-specific tags
  if (selectedTemplate) {
    const template = CONFIG.AI_TEMPLATES.find(t => t.id === selectedTemplate);
    if (template) {
      baseTags.push(template.category, `${template.title.toLowerCase().replace(/\s+/g, '-')}`);
    }
  }

  // Combine all tags
  let allTags = [...baseTags];
  if (platformTags[platform]) allTags.push(...platformTags[platform]);
  if (topicTags[topic]) allTags.push(...topicTags[topic]);
  if (audienceTags[audience]) allTags.push(...audienceTags[audience]);
  
  // Add custom tags
  if (customTags) {
    const custom = customTags.split(',').map(tag => tag.trim()).filter(tag => tag);
    allTags.push(...custom);
  }

  // Add trending tags
  const trendingTags = ['2024', 'viral content', 'must see', 'trending now'];
  allTags.push(...trendingTags);

  return [...new Set(allTags)].slice(0, 20);
}

// Build Enhanced HTML
function buildEnhancedHTML(title, description, imgUrl, videoUrl, content, tags, options) {
  let html = '';
  
  // Enhanced SEO Meta
  if (options.includeSEO) {
    html += generateAdvancedSEO(title, description, imgUrl, tags, options);
  }

  // Mobile optimization meta
  if (options.mobileOptimized) {
    html += `<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">\n`;
    html += `<meta name="mobile-web-app-capable" content="yes">\n`;
  }

  // Enhanced styling
  html += generateEnhancedCSS(options);

  // Main content structure
  html += generateContentStructure(title, description, imgUrl, videoUrl, content, tags, options);

  // Enhanced features
  if (options.includeAnalysis) {
    html += generateContentAnalysis(content, tags);
  }

  return html;
}

// Generate Advanced SEO
function generateAdvancedSEO(title, description, imgUrl, tags, options) {
  return `<!-- Advanced SEO Meta Tags -->\n` +
         `<title>${title}</title>\n` +
         `<meta name="description" content="${description}">\n` +
         `<meta name="keywords" content="${tags.join(', ')}">\n` +
         `<meta name="author" content="AI Content Generator V2">\n` +
         `<meta name="robots" content="index, follow">\n` +
         `<meta property="og:title" content="${title}">\n` +
         `<meta property="og:description" content="${description}">\n` +
         `<meta property="og:image" content="${imgUrl}">\n` +
         `<meta property="og:type" content="article">\n` +
         `<meta name="twitter:card" content="summary_large_image">\n` +
         `<meta name="twitter:title" content="${title}">\n` +
         `<meta name="twitter:description" content="${description}">\n` +
         `<meta name="twitter:image" content="${imgUrl}">\n` +
         `<link rel="canonical" href="#">\n\n`;
}

// Enhanced Utility Functions
function updateStats() {
  document.getElementById('totalPosts').textContent = appState.totalPosts;
  document.getElementById('totalImages').textContent = appState.totalImages;
  document.getElementById('totalViews').textContent = appState.totalViews;
  document.getElementById('successRate').textContent = appState.successRate;
  
  // Persist stats
  localStorage.setItem('totalPosts', appState.totalPosts);
  localStorage.setItem('totalImages', appState.totalImages);
  localStorage.setItem('totalViews', appState.totalViews);
  localStorage.setItem('successRate', appState.successRate);
}

function incrementStats(type) {
  appState[type]++;
  if (type === 'totalPosts') {
    appState.totalViews += Math.floor(Math.random() * 1000) + 500;
  }
  updateStats();
}

function updateSuccessRate() {
  // Simulate success rate calculation
  const currentRate = parseFloat(appState.successRate.replace('%', ''));
  const newRate = Math.min(99.5, currentRate + (Math.random() * 0.1));
  appState.successRate = `${newRate.toFixed(1)}%`;
}

// Enhanced Progress Management
function updateProgress(percentage) {
  const progressBars = ['progressBar', 'loadingProgress'];
  progressBars.forEach(id => {
    const bar = document.getElementById(id);
    if (bar) bar.style.width = `${percentage}%`;
  });
}

// Enhanced Loading Management
function showLoading(show, message = 'Processing...') {
  const overlay = document.getElementById('loadingOverlay');
  if (show) {
    overlay.querySelector('.loading-text').textContent = message;
    overlay.style.display = 'flex';
    document.body.style.overflow = 'hidden';
  } else {
    overlay.style.display = 'none';
    document.body.style.overflow = 'auto';
    updateProgress(0);
  }
}

// Enhanced Notification System
function showNotification(text, type = 'info') {
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  notification.textContent = text;
  
  document.body.appendChild(notification);
  
  // Trigger animation
  setTimeout(() => notification.classList.add('show'), 100);
  
  // Auto remove
  setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => {
      if (document.body.contains(notification)) {
        document.body.removeChild(notification);
      }
    }, 400);
  }, 4000);
}

// Enhanced Action Functions
function copyResult() {
  const textarea = document.getElementById('resultHTML');
  if (!textarea.value.trim()) {
    showNotification('No content to copy yet!', 'warning');
    return;
  }
  
  textarea.select();
  document.execCommand('copy');
  showNotification('HTML content copied successfully!', 'success');
}

function previewContent() {
  const html = document.getElementById('resultHTML').value.trim();
  if (!html) {
    showNotification('No content to preview yet!', 'warning');
    return;
  }
  
  const previewArea = document.getElementById('previewArea');
  const previewContent = document.getElementById('previewContent');
  
  previewContent.innerHTML = html;
  previewArea.style.display = 'block';
  previewArea.scrollIntoView({ behavior: 'smooth' });
  
  showNotification('Live preview loaded successfully!', 'success');
}

function downloadHTML() {
  const html = document.getElementById('resultHTML').value.trim();
  if (!html) {
    showNotification('No content to download yet!', 'warning');
    return;
  }
  
  const fileName = `enhanced-content-${Date.now()}.html`;
  const fullHTML = createFullHTMLDocument(html);
  downloadFile(fullHTML, fileName, 'text/html');
  showNotification('HTML file downloaded successfully!', 'success');
}

function exportToWordPress() {
  const html = document.getElementById('resultHTML').value.trim();
  if (!html) {
    showNotification('No content to export yet!', 'warning');
    return;
  }
  
  const formData = getEnhancedFormData();
  const wpContent = convertToWordPressFormat(html, formData);
  downloadFile(wpContent, `wp-post-${Date.now()}.txt`, 'text/plain');
  showNotification('WordPress post exported successfully!', 'success');
}

// NEW: Enhanced Functions
function shareToSocial() {
  const html = document.getElementById('resultHTML').value.trim();
  if (!html) {
    showNotification('Generate content first before sharing!', 'warning');
    return;
  }
  
  // Extract title from generated content
  const tempDiv = document.createElement('div');
  tempDiv.innerHTML = html;
  const title = tempDiv.querySelector('h1')?.textContent || 'Check out this amazing content!';
  
  const shareUrl = encodeURIComponent(window.location.href);
  const shareText = encodeURIComponent(title);
  
  const socialLinks = {
    facebook: `https://www.facebook.com/sharer/sharer.php?u=${shareUrl}`,
    twitter: `https://twitter.com/intent/tweet?text=${shareText}&url=${shareUrl}`,
    linkedin: `https://www.linkedin.com/sharing/share-offsite/?url=${shareUrl}`
  };
  
  // Show social sharing options
  const shareOptions = Object.keys(socialLinks).map(platform => 
    `<a href="${socialLinks[platform]}" target="_blank" style="margin: 0 10px; text-decoration: none; color: #667eea; font-weight: bold;">${platform.charAt(0).toUpperCase() + platform.slice(1)}</a>`
  ).join('');
  
  const shareDiv = document.createElement('div');
  shareDiv.innerHTML = `
    <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 10003; text-align: center;">
      <h3 style="margin-bottom: 20px; color: #374151;">Share Your Content</h3>
      <div>${shareOptions}</div>
      <button onclick="this.parentElement.parentElement.remove()" style="margin-top: 20px; padding: 10px 20px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer;">Close</button>
    </div>
    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10002;" onclick="this.parentElement.remove()"></div>
  `;
  
  document.body.appendChild(shareDiv);
}

function analyzeContent() {
  const html = document.getElementById('resultHTML').value.trim();
  if (!html) {
    showNotification('Generate content first for analysis!', 'warning');
    return;
  }
  
  // Simulate content analysis
  const analysis = performContentAnalysis(html);
  showAnalysisResults(analysis);
}

function performContentAnalysis(html) {
  const tempDiv = document.createElement('div');
  tempDiv.innerHTML = html;
  
  const textContent = tempDiv.textContent || '';
  const wordCount = textContent.split(/\s+/).length;
  const charCount = textContent.length;
  const imageCount = tempDiv.querySelectorAll('img').length;
  const linkCount = tempDiv.querySelectorAll('a').length;
  
  // Simulate engagement prediction
  const engagementScore = Math.floor(Math.random() * 20) + 80;
  const seoScore = Math.floor(Math.random() * 15) + 85;
  const readabilityScore = Math.floor(Math.random() * 10) + 90;
  
  return {
    wordCount,
    charCount,
    imageCount,
    linkCount,
    engagementScore,
    seoScore,
    readabilityScore,
    estimatedReachTime: `${Math.floor(wordCount / 200)} minutes`
  };
}

function showAnalysisResults(analysis) {
  const resultsHTML = `
    <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 40px; border-radius: 20px; box-shadow: 0 15px 40px rgba(0,0,0,0.3); z-index: 10003; max-width: 500px; width: 90%;">
      <h2 style="text-align: center; color: #374151; margin-bottom: 25px;">📊 Content Analytics</h2>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
        <div style="text-align: center; padding: 15px; background: #f8fafc; border-radius: 10px;">
          <div style="font-size: 2em; font-weight: bold; color: #667eea;">${analysis.wordCount}</div>
          <div style="color: #6b7280; font-size: 14px;">Words</div>
        </div>
        <div style="text-align: center; padding: 15px; background: #f8fafc; border-radius: 10px;">
          <div style="font-size: 2em; font-weight: bold; color: #10b981;">${analysis.imageCount}</div>
          <div style="color: #6b7280; font-size: 14px;">Images</div>
        </div>
      </div>
      
      <div style="margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
          <span>Engagement Score</span>
          <span style="font-weight: bold; color: #10b981;">${analysis.engagementScore}%</span>
        </div>
        <div style="background: #e5e7eb; border-radius: 10px; height: 8px;">
          <div style="background: linear-gradient(45deg, #10b981, #059669); height: 100%; width: ${analysis.engagementScore}%; border-radius: 10px;"></div>
        </div>
      </div>
      
      <div style="margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
          <span>SEO Score</span>
          <span style="font-weight: bold; color: #3b82f6;">${analysis.seoScore}%</span>
        </div>
        <div style="background: #e5e7eb; border-radius: 10px; height: 8px;">
          <div style="background: linear-gradient(45deg, #3b82f6, #2563eb); height: 100%; width: ${analysis.seoScore}%; border-radius: 10px;"></div>
        </div>
      </div>
      
      <div style="text-align: center; margin-bottom: 20px;">
        <p style="color: #6b7280; margin: 5px 0;">Estimated read time: <strong>${analysis.estimatedReachTime}</strong></p>
        <p style="color: #6b7280; margin: 5px 0;">Readability: <strong style="color: #10b981;">${analysis.readabilityScore}%</strong></p>
      </div>
      
      <button onclick="this.parentElement.parentElement.remove()" style="width: 100%; padding: 15px; background: linear-gradient(45deg, #667eea, #764ba2); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 16px;">Close Analysis</button>
    </div>
    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10002;" onclick="this.parentElement.remove()"></div>
  `;
  
  const analysisDiv = document.createElement('div');
  analysisDiv.innerHTML = resultsHTML;
  document.body.appendChild(analysisDiv);
  
  showNotification('Content analysis completed!', 'success');
}

// Statistics Display Functions
function showStats(type) {
  const statsData = {
    posts: `Total posts generated: ${appState.totalPosts}\nAverage per session: ${(appState.totalPosts / Math.max(1, appState.totalImages)).toFixed(1)}`,
    images: `Images uploaded: ${appState.totalImages}\nSuccess rate: ${appState.successRate}\nAverage size: 2.3MB`,
    templates: `Available templates: 30+\nMost popular: Viral TikTok\nSuccess rate: 94%`,
    styles: `Writing styles: 8\nMost used: Seductive & Alluring\nEffectiveness: 96%`,
    analytics: `Total views: ${appState.totalViews}\nAverage engagement: 87%\nConversion rate: 12%`,
    success: `Success rate: ${appState.successRate}\nError rate: ${(100 - parseFloat(appState.successRate.replace('%', ''))).toFixed(1)}%\nUser satisfaction: 94%`
  };
  
  alert(statsData[type] || 'Stats not available');
}

// Enhanced Auto-save and Data Management
function autoSave() {
  const formData = getEnhancedFormData();
  localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(formData));
}

function loadSavedData() {
  const saved = localStorage.getItem(CONFIG.STORAGE_KEY);
  if (saved) {
    try {
      const data = JSON.parse(saved);
      Object.keys(data).forEach(key => {
        const element = document.getElementById(key);
        if (element) {
          if (element.type === 'checkbox') {
            element.checked = data[key];
          } else if (element.type === 'range') {
            element.value = data[key];
            const valueDisplay = document.getElementById(key.replace('Level', 'Value'));
            if (valueDisplay) valueDisplay.textContent = data[key];
          } else {
            element.value = data[key];
          }
        }
      });
    } catch(e) {
      console.log('No valid saved data found');
    }
  }
}

// Enhanced Keyboard Shortcuts
function handleEnhancedShortcuts(e) {
  if (e.ctrlKey || e.metaKey) {
    switch(e.key) {
      case 'Enter':
        e.preventDefault();
        generateArticle();
        break;
      case 's':
        e.preventDefault();
        copyResult();
        break;
      case 'p':
        e.preventDefault();
        previewContent();
        break;
      case 'd':
        e.preventDefault();
        downloadHTML();
        break;
      case 'e':
        e.preventDefault();
        exportToWordPress();
        break;
      case 'a':
        e.preventDefault();
        analyzeContent();
        break;
    }
  }
  
  // Quick template selection with number keys
  if (e.altKey && e.key >= '1' && e.key <= '6') {
    e.preventDefault();
    const templateIndex = parseInt(e.key) - 1;
    if (CONFIG.AI_TEMPLATES[templateIndex]) {
      selectTemplate(CONFIG.AI_TEMPLATES[templateIndex].id);
    }
  }
}

// Scroll Management
function handleScroll() {
  const fab = document.querySelector('.fab');
  if (window.scrollY > 300) {
    fab.style.display = 'flex';
  } else {
    fab.style.display = 'none';
  }
}

function scrollToTop() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function scrollToResult() {
  document.getElementById('resultHTML').scrollIntoView({ 
    behavior: 'smooth', 
    block: 'center' 
  });
}

// Enhanced Helper Functions
function showSuccessMessage() {
  const message = document.getElementById('successMessage');
  message.style.display = 'flex';
  setTimeout(() => {
    message.style.display = 'none';
  }, 4000);
}

function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

function pick(array) {
  return array[Math.floor(Math.random() * array.length)];
}

function shuffle(array) {
  const result = [...array];
  for (let i = result.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [result[i], result[j]] = [result[j], result[i]];
  }
  return result;
}

// File Download Management
function downloadFile(content, fileName, mimeType) {
  const blob = new Blob([content], { type: mimeType });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = fileName;
  a.style.display = 'none';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

function createFullHTMLDocument(content) {
  return `<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Generated Content - Enhanced V2</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; 
            max-width: 1000px; margin: 0 auto; padding: 20px; 
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            line-height: 1.6; color: #2d3748;
        }
        .container { 
            background: white; padding: 40px; border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
        }
        img { 
            max-width: 100%; height: auto; border-radius: 15px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        a { color: #667eea; text-decoration: none; font-weight: 500; }
        a:hover { text-decoration: underline; }
        h1, h2, h3 { margin-bottom: 1em; color: #2d3748; }
        p { margin-bottom: 1em; }
        .meta { 
            font-size: 0.9em; color: #718096; 
            border-top: 1px solid #e2e8f0; 
            padding-top: 20px; margin-top: 40px; 
            text-align: center;
        }
        @media (max-width: 768px) {
            body { padding: 15px; }
            .container { padding: 25px; }
        }
    </style>
</head>
<body>
    <div class="container">
        ${content}
        <div class="meta">
            Generated by AI Content Generator V2 | ${new Date().toLocaleDateString('vi-VN')}
        </div>
    </div>
</body>
</html>`;
}

function convertToWordPressFormat(html, formData) {
  const subject = formData.characterName || 'AI Generated Subject';
  const tags = generateSmartTags(formData);
  const title = generateEnhancedTitle(subject, formData);
  
  // Clean HTML for WordPress
  const cleanHTML = html
    .replace(/<style[^>]*>.*?<\/style>/gs, '')
    .replace(/style="[^"]*"/g, '')
    .replace(/class="[^"]*"/g, '');
  
  return `WordPress Post Export - Enhanced V2
========================================

Post Title: ${title}

Content:
${cleanHTML}

Tags: ${tags.join(', ')}

Categories: ${formData.topic}, ${formData.country}, ${formData.platform}

Featured Image: ${formData.imgurLink}

Post Excerpt: ${generateEnhancedDescription(subject, formData)}

Custom Fields:
- ai_generated: true
- content_version: ${CONFIG.VERSION}
- generation_date: ${new Date().toISOString()}
- creativity_level: ${formData.creativityLevel}
- selected_template: ${formData.selectedTemplate || 'none'}
- target_platform: ${formData.platform}
- target_audience: ${formData.audience}

SEO Settings:
- Meta Title: ${title}
- Meta Description: ${generateEnhancedDescription(subject, formData)}
- Focus Keyword: ${tags[0]}

Generated: ${new Date().toLocaleString('vi-VN')}
Generator: AI Content Generator V2.0`;
}

// Content Analytics and Tracking
function trackContentGeneration(formData) {
  // Track usage analytics (privacy-friendly)
  const analytics = {
    timestamp: Date.now(),
    platform: formData.platform,
    topic: formData.topic,
    style: formData.style,
    length: formData.length,
    template: formData.selectedTemplate,
    hasImage: !!formData.imgurLink,
    hasVideo: !!formData.videoLink,
    creativityLevel: formData.creativityLevel
  };
  
  // Store in local analytics (no external tracking)
  const existingAnalytics = JSON.parse(localStorage.getItem('contentAnalytics') || '[]');
  existingAnalytics.push(analytics);
  
  // Keep only last 100 entries
  if (existingAnalytics.length > 100) {
    existingAnalytics.splice(0, existingAnalytics.length - 100);
  }
  
  localStorage.setItem('contentAnalytics', JSON.stringify(existingAnalytics));
}

// Help System Initialization
function initializeHelp() {
  // Create help tooltips for complex features
  const helpElements = [
    { id: 'creativityLevel', help: 'Higher values create more unique and creative content' },
    { id: 'aiUpscale', help: 'Enhance image quality using AI upscaling' },
    { id: 'includeAnalysis', help: 'Add content performance analysis' }
  ];
  
  helpElements.forEach(({ id, help }) => {
    const element = document.getElementById(id);
    if (element) {
      element.title = help;
    }
  });
}

// Version Check
function checkForUpdates() {
  const lastVersion = localStorage.getItem('lastVersion');
  if (lastVersion !== CONFIG.VERSION) {
    localStorage.setItem('lastVersion', CONFIG.VERSION);
    setTimeout(() => {
      showNotification(`Welcome to Content Generator V${CONFIG.VERSION}! New features available.`, 'info');
    }, 2000);
  }
}

// Enhanced Content Generation Functions
function getDefaultSubject(topic, country) {
  const subjects = {
    'facebook-girl': `Facebook Beauty ${country}`,
    'instagram-girl': `Instagram Model ${country}`,
    'tiktok-girl': `TikTok Star ${country}`,
    'twitter-girl': `Twitter Personality ${country}`,
    'youtube-girl': `YouTube Creator ${country}`,
    'linkedin-girl': `Professional Model ${country}`,
    'vn-girl': 'Vietnamese Beauty',
    'japan-girl': 'Japanese Kawaii Model',
    'korea-girl': 'Korean Style Icon',
    'china-girl': 'Chinese Elegance',
    'thai-girl': 'Thai Beauty Queen',
    'europe-girl': 'European Style Model',
    'america-girl': 'American Beauty',
    'short-hair': `Short Hair Beauty ${country}`,
    'long-hair': `Long Hair Model ${country}`,
    'cute-girl': `Cute Aesthetic ${country}`,
    'elegant-girl': `Elegant Beauty ${country}`,
    'sporty-girl': `Athletic Model ${country}`,
    'artsy-girl': `Artistic Beauty ${country}`,
    'minimalist-girl': `Minimalist Style ${country}`,
    'bikini': `Swimwear Model ${country}`,
    'ao-dai': 'Vietnamese Traditional Beauty',
    'school': `Student Beauty ${country}`,
    'casual': `Casual Style ${country}`,
    'formal': `Formal Beauty ${country}`,
    'street-fashion': `Street Style ${country}`,
    'vintage': `Vintage Fashion ${country}`,
    'futuristic': `Future Fashion ${country}`,
    'hotgirl': `Influencer ${country}`,
    'model': `Professional Model ${country}`,
    'idol': `Entertainment Idol ${country}`,
    'actress': `Actress ${country}`,
    'streamer': `Content Creator ${country}`,
    'dancer': `Professional Dancer ${country}`,
    'singer': `Vocalist ${country}`,
    'cosplay': `Cosplayer ${country}`,
    'wallpaper': `Wallpaper Model ${country}`,
    'photography': `Photography Model ${country}`,
    'lifestyle': `Lifestyle Influencer ${country}`,
    'travel': `Travel Beauty ${country}`,
    'fitness': `Fitness Model ${country}`
  };
  
  return subjects[topic] || `Beauty Model ${country}`;
}

function generateEnhancedDescription(subject, formData) {
  const { platform, topic, style, country } = formData;
  
  const descriptions = [
    `Discover the stunning ${subject} in this exclusive ${platform} collection. High-quality content featuring ${country}'s most captivating beauty.`,
    `Premium ${subject} gallery with professional photography and ${style} aesthetic. Perfect for ${platform} sharing and engagement.`,
    `${subject} brings incredible beauty and charm in this curated collection. Trending content with viral potential on ${platform}.`,
    `Exclusive showcase of ${subject} with ${topic} theme. Quality content designed for maximum ${platform} engagement and reach.`
  ];
  
  return pick(descriptions);
}

function generateStyleBasedContent(subject, style, length, formData) {
  // This would contain the enhanced content generation logic
  // For brevity, returning a simplified version
  return {
    content: `<p>Enhanced ${style} content for ${subject} with ${length} format optimized for ${formData.platform}.</p>`
  };
}

// Initialize everything when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initializeApp);
} else {
  initializeApp();
}

</script>

</body>
</html>
